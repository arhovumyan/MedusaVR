import{j as e}from"./ui-vendor-yJ52fMSG.js";import{u as x,C as t,B as n}from"./index-KQwLGX-o.js";import{A as i,b as o}from"./alert-BjOGaUfg.js";import{C as u,b as g,c as j,a as p}from"./card-CARjWDBb.js";import"./react-vendor-CgzYKCvO.js";import"./routing-DoJeAdmJ.js";import"./query-vendor-8KRGqY0G.js";import"./utils--BulIq_u.js";import"./icons-B1tK8ZjU.js";function f(){const{isAuthenticated:c,user:l,isLoading:d}=x(),s={hookAuthenticated:c,hookUser:l,hookLoading:d,accessToken:localStorage.getItem("medusavr_access_token"),refreshToken:localStorage.getItem("medusavr_refresh_token"),storedUser:localStorage.getItem("medusavr_user"),firebaseUser:t.currentUser,firebaseEmail:t.currentUser?.email,firebaseUid:t.currentUser?.uid},h=async()=>{try{if(t.currentUser){const r=await t.currentUser.getIdToken();console.log("Firebase ID Token:",r),alert(`Firebase ID Token (first 50 chars): ${r.substring(0,50)}...`)}else alert("No Firebase user found")}catch(r){console.error("Error getting ID token:",r),alert(`Error: ${r}`)}},m=async()=>{try{const r=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("medusavr_access_token")}`}});if(r.ok){const a=await r.json();console.log("API Response:",a),alert("API call successful! Check console for details.")}else{const a=await r.text();console.error("API Error:",r.status,a),alert(`API Error: ${r.status} - ${a}`)}}catch(r){console.error("API Request failed:",r),alert(`Request failed: ${r}`)}};return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto space-y-6",children:[e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(j,{children:"Authentication Debug Information"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Auth Hook Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Authenticated:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-sm ${s.hookAuthenticated?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.hookAuthenticated?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Loading:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-sm ${s.hookLoading?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.hookLoading?"Yes":"No"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-medium",children:"User:"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(s.hookUser,null,2)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Local Storage"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Access Token:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-sm ${s.accessToken?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.accessToken?`Present (${s.accessToken.substring(0,20)}...)`:"Missing"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Refresh Token:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-sm ${s.refreshToken?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.refreshToken?"Present":"Missing"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Stored User:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-sm ${s.storedUser?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.storedUser?"Present":"Missing"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Firebase Auth"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Firebase User:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-sm ${s.firebaseUser?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.firebaseUser?"Present":"Missing"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{className:"ml-2",children:s.firebaseEmail||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"UID:"}),e.jsx("span",{className:"ml-2",children:s.firebaseUid||"N/A"})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(n,{onClick:h,variant:"outline",children:"Get Firebase ID Token"}),e.jsx(n,{onClick:m,variant:"outline",children:"Test API Call"})]})]})})]}),!s.hookAuthenticated&&s.firebaseUser&&e.jsx(i,{children:e.jsxs(o,{children:[e.jsx("strong",{children:"Issue Detected:"})," Firebase user exists but auth hook shows not authenticated. This usually means the backend authentication flow hasn't completed successfully."]})}),s.hookAuthenticated&&!s.accessToken&&e.jsx(i,{children:e.jsxs(o,{children:[e.jsx("strong",{children:"Issue Detected:"})," Auth hook shows authenticated but no access token found. API calls will fail until this is resolved."]})})]})}function w(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-zinc-900 via-zinc-800 to-orange-900/20",children:e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-8 text-center",children:"Authentication Debug"}),e.jsx(f,{})]})})}export{w as default};
