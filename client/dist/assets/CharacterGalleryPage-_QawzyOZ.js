import{j as e}from"./ui-vendor-yJ52fMSG.js";import{M as R,u as U,B as w,L as N,b as k}from"./index-RHqJfvrp.js";import{C as $,a as G}from"./card-CLyBdkuB.js";import{b as C}from"./query-vendor-8KRGqY0G.js";import{u as O,c as E,L as v}from"./routing-DoJeAdmJ.js";import{r as l}from"./react-vendor-CgzYKCvO.js";import{Q as j,as as A,X as F,u as P,R as B,am as D}from"./icons-CPY5GJO9.js";import"./utils--BulIq_u.js";const S=l.memo(({image:a,isOpen:m,onClose:c})=>{const s=l.useCallback(async()=>{if(a?.url)try{const g=await(await fetch(a.url)).blob(),r=window.URL.createObjectURL(g),i=document.createElement("a");i.href=r,i.download=a.filename||`character-image-${Date.now()}.webp`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}catch(n){console.error("Failed to download image:",n)}},[a]);return!m||!a?null:e.jsx("div",{className:"fixed inset-0 z-[999999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-2 sm:p-4",style:{zIndex:999999},onClick:c,children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center image-modal-container",style:{maxWidth:"calc(100vw - 16px)",maxHeight:"calc(100vh - 16px)"},children:[e.jsx("button",{onClick:c,className:"absolute top-2 right-2 z-10 w-8 h-8 sm:w-10 sm:h-10 bg-black/80 hover:bg-black text-white rounded-full flex items-center justify-center transition-colors duration-200 border border-white/20",children:e.jsx(F,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:s,className:"absolute top-2 right-12 sm:right-16 z-10 w-8 h-8 sm:w-10 sm:h-10 bg-orange-500/80 hover:bg-orange-500 text-white rounded-full flex items-center justify-center transition-colors duration-200 border border-orange-500/40",children:e.jsx(j,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("img",{src:a.url,alt:"Generated character image",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl image-modal-image",style:{maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 32px)",width:"auto",height:"auto"},onClick:n=>n.stopPropagation()})]})})}),q=l.memo(()=>e.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-gradient-to-br from-zinc-800 via-zinc-700 to-zinc-800 aspect-square",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-zinc-600/30 to-transparent animate-pulse"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-zinc-400",children:[e.jsx(P,{className:"w-8 h-8 mb-3 animate-spin text-orange-500"}),e.jsx("div",{className:"text-sm font-medium mb-1",children:"Generating Image"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Please wait..."})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-shimmer"})]})),T=l.memo(({image:a,onImageClick:m})=>{const[c,s]=l.useState(!1),[n,g]=l.useState(1);if(a.isBuffer)return e.jsx(q,{});const r=l.useCallback(d=>{const t=d.currentTarget;g(t.naturalWidth/t.naturalHeight),s(!0)},[]),i=l.useCallback(async d=>{d.stopPropagation();try{const h=await(await fetch(a.url)).blob(),b=window.URL.createObjectURL(h),u=document.createElement("a");u.href=b,u.download=a.filename||`character-image-${Date.now()}.webp`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(b)}catch(t){console.error("Failed to download image:",t)}},[a]);return e.jsxs("div",{className:"group relative cursor-pointer overflow-hidden rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-xl hover:shadow-orange-500/20",onClick:()=>m(a),style:{aspectRatio:n>0?n:1},children:[!c&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-zinc-800 via-zinc-700 to-zinc-800 animate-pulse rounded-lg"}),e.jsx("img",{src:a.url,alt:"Generated character image",className:`w-full h-full object-cover transition-all duration-300 ${c?"opacity-100":"opacity-0"} group-hover:scale-105`,onLoad:r,onError:()=>s(!0),loading:"lazy",decoding:"async"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-300 flex items-center justify-center",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex gap-3",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),m(a)},className:"w-10 h-10 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsx("button",{onClick:i,className:"w-10 h-10 bg-orange-500/80 hover:bg-orange-500 backdrop-blur-sm border border-orange-500/40 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110",children:e.jsx(j,{className:"w-4 h-4"})})]})})]})}),M=({images:a,title:m,maxDisplay:c=12,onSeeMore:s,showSeeMore:n=!1})=>{const[g,r]=l.useState(null),[i,d]=l.useState(!1),t=l.useCallback(o=>{o.isBuffer||(r(o),d(!0))},[]),h=l.useCallback(()=>{d(!1),r(null)},[]),b=l.useCallback(async()=>{if(!(!a||a.length===0))try{const o=a.map(async(x,L)=>{const z=await(await fetch(x.url)).blob(),y=window.URL.createObjectURL(z),p=document.createElement("a");p.href=y,p.download=x.filename||`character-image-${L+1}.webp`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(y),await new Promise(I=>setTimeout(I,100))});await Promise.all(o)}catch(o){console.error("Failed to download images:",o)}},[a]);if(!a||a.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-zinc-400 text-lg",children:"No images generated yet"}),e.jsx("div",{className:"text-zinc-500 text-sm mt-2",children:"Start generating to see your character images here"})]});const u=c?a.slice(0,c):a,f=a.length>c;return e.jsxs(e.Fragment,{children:[m&&e.jsx("h3",{className:"text-lg font-semibold text-zinc-200 mb-4",children:m}),e.jsx("div",{className:"grid gap-4 auto-rows-max",style:{gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:u.map((o,x)=>e.jsx(T,{image:o,onImageClick:t},o.id||o.url||x))}),a.length>0&&e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-4 justify-center items-center",children:[e.jsxs("button",{onClick:b,className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold rounded-lg shadow-lg shadow-blue-500/25 transition-all duration-300 hover:scale-105",children:[e.jsx(j,{className:"w-4 h-4"}),"Download All (",a.length,")"]}),(f||n)&&s&&e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white font-semibold rounded-lg shadow-lg shadow-orange-500/25 transition-all duration-300 hover:scale-105",children:[e.jsx(R,{className:"w-4 h-4"}),"See All Images (",a.length,")"]})]}),e.jsx(S,{image:g,isOpen:i,onClose:h})]})},W=l.memo(M),ee=()=>{const{user:a}=U();O();const[m,c]=E("/character-gallery/:characterId"),s=c?.characterId,{data:n,isLoading:g}=C({queryKey:["character",s],queryFn:async()=>await(await k("GET",`/api/characters/${s}`,void 0,{},"medium")).json(),enabled:!!s}),{data:r=[],isLoading:i}=C({queryKey:["character-images-all",s],queryFn:async()=>(await(await k("GET",`/api/image-generation/character/${s}?all=true`,void 0,{},"medium")).json()).data?.images||[],enabled:!!s});if(!m||!s)return e.jsx("div",{className:"min-h-screen bg-zinc-900 text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"Character Not Found"}),e.jsx(v,{href:"/generate-images",children:e.jsx(w,{className:"bg-orange-500 hover:bg-orange-600",children:"Back to Generate Images"})})]})});if(g)return e.jsx("div",{className:"min-h-screen bg-zinc-900 text-white flex items-center justify-center",children:e.jsx(N,{})});const d=async()=>{if(r.length!==0)try{for(let t=0;t<r.length;t++){const h=r[t],u=await(await fetch(h.url)).blob(),f=window.URL.createObjectURL(u),o=document.createElement("a");o.href=f,o.download=`${n?.name||"character"}-image-${t+1}.webp`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(f),t<r.length-1&&await new Promise(x=>setTimeout(x,500))}}catch(t){console.error("Failed to download images:",t)}};return e.jsx("div",{className:"min-h-screen bg-zinc-900 text-white pb-16 lg:pb-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(v,{href:`/generate-images?characterId=${s}&returnFromGallery=true`,children:e.jsxs(w,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Back to Workshop"]})}),r.length>0&&e.jsxs(w,{onClick:d,className:"flex items-center gap-2 bg-orange-500 hover:bg-orange-600",children:[e.jsx(j,{className:"w-4 h-4"}),"Download All (",r.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[n?.avatar&&e.jsx("img",{src:n.avatar,alt:n.name,className:"w-16 h-16 rounded-lg object-cover border-2 border-orange-500/30"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent",children:[n?.name," Gallery"]}),e.jsxs("p",{className:"text-zinc-400 mt-1",children:["All generated images for this character (",r.length," total)"]})]})]})]}),e.jsx($,{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border border-orange-500/20 shadow-2xl shadow-orange-500/10",children:e.jsx(G,{className:"p-6",children:i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{}),e.jsx("p",{className:"text-zinc-500 text-sm mt-4",children:"Loading gallery..."})]}):r.length>0?e.jsx(W,{images:r.map((t,h)=>({url:t.url,id:`gallery-${h}`,filename:`${n?.name||"character"}-image-${h+1}.webp`})),title:`Complete Gallery (${r.length} images)`}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-zinc-600 mx-auto mb-4"}),e.jsx("div",{className:"text-zinc-400 text-lg mb-2",children:"No images found"}),e.jsx("div",{className:"text-zinc-500 text-sm",children:"No images have been generated for this character yet."}),e.jsx(v,{href:`/generate-images?characterId=${s}`,children:e.jsx(w,{className:"mt-4 bg-orange-500 hover:bg-orange-600",children:"Generate Images"})})]})})})]})})};export{ee as default};
