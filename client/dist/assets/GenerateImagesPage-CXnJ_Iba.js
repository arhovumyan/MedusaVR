import{E as as,b as Ae,j as e,c as st,K as $e,a as ls,u as q,h as ne,P as D,e as L,g as is,f as cs,L as ds,M as ms,N as us,Q as hs,U as ps,D as fs,d as gs}from"./ui-vendor-yJ52fMSG.js";import{r as s,b as nt}from"./react-vendor-CgzYKCvO.js";import{E as rt,R as xs,V as bs,G as vs,J as ws,K as js,c as J,y as ys,u as Ns,d as Ss,B as Ke,L as Cs,A as Is,b as pe}from"./index-BjPJS_Ij.js";import{C as qe,a as Ye}from"./card-CqQ-sF9c.js";import{T as ks}from"./textarea-BVwmO6_d.js";import{u as ot,c as Ze}from"./index-Bk2AHYaC.js";import{k as at,_ as lt,z as it,aj as ct,ak as dt,as as Rs,Q as Ue,X as mt,u as Ps,R as Ts,j as Xe,I as Se,v as Ce,T as Je,Z as Qe,a4 as Es,a3 as _s}from"./icons-B1tK8ZjU.js";import{u as Ls,b as Ie}from"./query-vendor-8KRGqY0G.js";import{u as As,L as et}from"./routing-DoJeAdmJ.js";import{f as zs,A as ke,v as tt,a as Ms,V as Os}from"./violation-tracker-B7Z4jDAE.js";import"./utils--BulIq_u.js";var Ds=[" ","Enter","ArrowUp","ArrowDown"],Bs=[" ","Enter"],de="Select",[Pe,Te,$s]=ls(de),[fe,On]=st(de,[$s,rt]),Ee=rt(),[Us,re]=fe(de),[Fs,Vs]=fe(de),ut=t=>{const{__scopeSelect:o,children:n,open:d,defaultOpen:r,onOpenChange:u,value:l,defaultValue:i,onValueChange:c,dir:p,name:b,autoComplete:v,disabled:y,required:I,form:N}=t,m=Ee(o),[g,x]=s.useState(null),[f,j]=s.useState(null),[B,R]=s.useState(!1),Z=as(p),[P,$]=Ae({prop:d,defaultProp:r??!1,onChange:u,caller:de}),[F,z]=Ae({prop:l,defaultProp:i,onChange:c,caller:de}),V=s.useRef(null),H=g?N||!!g.closest("form"):!0,[X,T]=s.useState(new Set),G=Array.from(X).map(M=>M.props.value).join(";");return e.jsx(xs,{...m,children:e.jsxs(Us,{required:I,scope:o,trigger:g,onTriggerChange:x,valueNode:f,onValueNodeChange:j,valueNodeHasChildren:B,onValueNodeHasChildrenChange:R,contentId:$e(),value:F,onValueChange:z,open:P,onOpenChange:$,dir:Z,triggerPointerDownPosRef:V,disabled:y,children:[e.jsx(Pe.Provider,{scope:o,children:e.jsx(Fs,{scope:t.__scopeSelect,onNativeOptionAdd:s.useCallback(M=>{T(K=>new Set(K).add(M))},[]),onNativeOptionRemove:s.useCallback(M=>{T(K=>{const E=new Set(K);return E.delete(M),E})},[]),children:n})}),H?e.jsxs(Mt,{"aria-hidden":!0,required:I,tabIndex:-1,name:b,autoComplete:v,value:F,onChange:M=>z(M.target.value),disabled:y,form:N,children:[F===void 0?e.jsx("option",{value:""}):null,Array.from(X)]},G):null]})})};ut.displayName=de;var ht="SelectTrigger",pt=s.forwardRef((t,o)=>{const{__scopeSelect:n,disabled:d=!1,...r}=t,u=Ee(n),l=re(ht,n),i=l.disabled||d,c=q(o,l.onTriggerChange),p=Te(n),b=s.useRef("touch"),[v,y,I]=Dt(m=>{const g=p().filter(j=>!j.disabled),x=g.find(j=>j.value===l.value),f=Bt(g,m,x);f!==void 0&&l.onValueChange(f.value)}),N=m=>{i||(l.onOpenChange(!0),I()),m&&(l.triggerPointerDownPosRef.current={x:Math.round(m.pageX),y:Math.round(m.pageY)})};return e.jsx(vs,{asChild:!0,...u,children:e.jsx(D.button,{type:"button",role:"combobox","aria-controls":l.contentId,"aria-expanded":l.open,"aria-required":l.required,"aria-autocomplete":"none",dir:l.dir,"data-state":l.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Ot(l.value)?"":void 0,...r,ref:c,onClick:L(r.onClick,m=>{m.currentTarget.focus(),b.current!=="mouse"&&N(m)}),onPointerDown:L(r.onPointerDown,m=>{b.current=m.pointerType;const g=m.target;g.hasPointerCapture(m.pointerId)&&g.releasePointerCapture(m.pointerId),m.button===0&&m.ctrlKey===!1&&m.pointerType==="mouse"&&(N(m),m.preventDefault())}),onKeyDown:L(r.onKeyDown,m=>{const g=v.current!=="";!(m.ctrlKey||m.altKey||m.metaKey)&&m.key.length===1&&y(m.key),!(g&&m.key===" ")&&Ds.includes(m.key)&&(N(),m.preventDefault())})})})});pt.displayName=ht;var ft="SelectValue",gt=s.forwardRef((t,o)=>{const{__scopeSelect:n,className:d,style:r,children:u,placeholder:l="",...i}=t,c=re(ft,n),{onValueNodeHasChildrenChange:p}=c,b=u!==void 0,v=q(o,c.onValueNodeChange);return ne(()=>{p(b)},[p,b]),e.jsx(D.span,{...i,ref:v,style:{pointerEvents:"none"},children:Ot(c.value)?e.jsx(e.Fragment,{children:l}):u})});gt.displayName=ft;var Hs="SelectIcon",xt=s.forwardRef((t,o)=>{const{__scopeSelect:n,children:d,...r}=t;return e.jsx(D.span,{"aria-hidden":!0,...r,ref:o,children:d||"▼"})});xt.displayName=Hs;var Gs="SelectPortal",bt=t=>e.jsx(is,{asChild:!0,...t});bt.displayName=Gs;var me="SelectContent",vt=s.forwardRef((t,o)=>{const n=re(me,t.__scopeSelect),[d,r]=s.useState();if(ne(()=>{r(new DocumentFragment)},[]),!n.open){const u=d;return u?nt.createPortal(e.jsx(wt,{scope:t.__scopeSelect,children:e.jsx(Pe.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),u):null}return e.jsx(jt,{...t,ref:o})});vt.displayName=me;var Y=10,[wt,oe]=fe(me),Ws="SelectContentImpl",Ks=hs("SelectContent.RemoveScroll"),jt=s.forwardRef((t,o)=>{const{__scopeSelect:n,position:d="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:u,onPointerDownOutside:l,side:i,sideOffset:c,align:p,alignOffset:b,arrowPadding:v,collisionBoundary:y,collisionPadding:I,sticky:N,hideWhenDetached:m,avoidCollisions:g,...x}=t,f=re(me,n),[j,B]=s.useState(null),[R,Z]=s.useState(null),P=q(o,w=>B(w)),[$,F]=s.useState(null),[z,V]=s.useState(null),H=Te(n),[X,T]=s.useState(!1),G=s.useRef(!1);s.useEffect(()=>{if(j)return ds(j)},[j]),ms();const M=s.useCallback(w=>{const[_,...O]=H().map(h=>h.ref.current),[k]=O.slice(-1),a=document.activeElement;for(const h of w)if(h===a||(h?.scrollIntoView({block:"nearest"}),h===_&&R&&(R.scrollTop=0),h===k&&R&&(R.scrollTop=R.scrollHeight),h?.focus(),document.activeElement!==a))return},[H,R]),K=s.useCallback(()=>M([$,j]),[M,$,j]);s.useEffect(()=>{X&&K()},[X,K]);const{onOpenChange:E,triggerPointerDownPosRef:W}=f;s.useEffect(()=>{if(j){let w={x:0,y:0};const _=k=>{w={x:Math.abs(Math.round(k.pageX)-(W.current?.x??0)),y:Math.abs(Math.round(k.pageY)-(W.current?.y??0))}},O=k=>{w.x<=10&&w.y<=10?k.preventDefault():j.contains(k.target)||E(!1),document.removeEventListener("pointermove",_),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",_),document.addEventListener("pointerup",O,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",O,{capture:!0})}}},[j,E,W]),s.useEffect(()=>{const w=()=>E(!1);return window.addEventListener("blur",w),window.addEventListener("resize",w),()=>{window.removeEventListener("blur",w),window.removeEventListener("resize",w)}},[E]);const[Q,ge]=Dt(w=>{const _=H().filter(a=>!a.disabled),O=_.find(a=>a.ref.current===document.activeElement),k=Bt(_,w,O);k&&setTimeout(()=>k.ref.current.focus())}),ue=s.useCallback((w,_,O)=>{const k=!G.current&&!O;(f.value!==void 0&&f.value===_||k)&&(F(w),k&&(G.current=!0))},[f.value]),xe=s.useCallback(()=>j?.focus(),[j]),ee=s.useCallback((w,_,O)=>{const k=!G.current&&!O;(f.value!==void 0&&f.value===_||k)&&V(w)},[f.value]),ae=d==="popper"?ze:yt,le=ae===ze?{side:i,sideOffset:c,align:p,alignOffset:b,arrowPadding:v,collisionBoundary:y,collisionPadding:I,sticky:N,hideWhenDetached:m,avoidCollisions:g}:{};return e.jsx(wt,{scope:n,content:j,viewport:R,onViewportChange:Z,itemRefCallback:ue,selectedItem:$,onItemLeave:xe,itemTextRefCallback:ee,focusSelectedItem:K,selectedItemText:z,position:d,isPositioned:X,searchRef:Q,children:e.jsx(us,{as:Ks,allowPinchZoom:!0,children:e.jsx(ps,{asChild:!0,trapped:f.open,onMountAutoFocus:w=>{w.preventDefault()},onUnmountAutoFocus:L(r,w=>{f.trigger?.focus({preventScroll:!0}),w.preventDefault()}),children:e.jsx(fs,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:l,onFocusOutside:w=>w.preventDefault(),onDismiss:()=>f.onOpenChange(!1),children:e.jsx(ae,{role:"listbox",id:f.contentId,"data-state":f.open?"open":"closed",dir:f.dir,onContextMenu:w=>w.preventDefault(),...x,...le,onPlaced:()=>T(!0),ref:P,style:{display:"flex",flexDirection:"column",outline:"none",...x.style},onKeyDown:L(x.onKeyDown,w=>{const _=w.ctrlKey||w.altKey||w.metaKey;if(w.key==="Tab"&&w.preventDefault(),!_&&w.key.length===1&&ge(w.key),["ArrowUp","ArrowDown","Home","End"].includes(w.key)){let k=H().filter(a=>!a.disabled).map(a=>a.ref.current);if(["ArrowUp","End"].includes(w.key)&&(k=k.slice().reverse()),["ArrowUp","ArrowDown"].includes(w.key)){const a=w.target,h=k.indexOf(a);k=k.slice(h+1)}setTimeout(()=>M(k)),w.preventDefault()}})})})})})})});jt.displayName=Ws;var qs="SelectItemAlignedPosition",yt=s.forwardRef((t,o)=>{const{__scopeSelect:n,onPlaced:d,...r}=t,u=re(me,n),l=oe(me,n),[i,c]=s.useState(null),[p,b]=s.useState(null),v=q(o,P=>b(P)),y=Te(n),I=s.useRef(!1),N=s.useRef(!0),{viewport:m,selectedItem:g,selectedItemText:x,focusSelectedItem:f}=l,j=s.useCallback(()=>{if(u.trigger&&u.valueNode&&i&&p&&m&&g&&x){const P=u.trigger.getBoundingClientRect(),$=p.getBoundingClientRect(),F=u.valueNode.getBoundingClientRect(),z=x.getBoundingClientRect();if(u.dir!=="rtl"){const a=z.left-$.left,h=F.left-a,C=P.left-h,S=P.width+C,A=Math.max(S,$.width),U=window.innerWidth-Y,ie=Ze(h,[Y,Math.max(Y,U-A)]);i.style.minWidth=S+"px",i.style.left=ie+"px"}else{const a=$.right-z.right,h=window.innerWidth-F.right-a,C=window.innerWidth-P.right-h,S=P.width+C,A=Math.max(S,$.width),U=window.innerWidth-Y,ie=Ze(h,[Y,Math.max(Y,U-A)]);i.style.minWidth=S+"px",i.style.right=ie+"px"}const V=y(),H=window.innerHeight-Y*2,X=m.scrollHeight,T=window.getComputedStyle(p),G=parseInt(T.borderTopWidth,10),M=parseInt(T.paddingTop,10),K=parseInt(T.borderBottomWidth,10),E=parseInt(T.paddingBottom,10),W=G+M+X+E+K,Q=Math.min(g.offsetHeight*5,W),ge=window.getComputedStyle(m),ue=parseInt(ge.paddingTop,10),xe=parseInt(ge.paddingBottom,10),ee=P.top+P.height/2-Y,ae=H-ee,le=g.offsetHeight/2,w=g.offsetTop+le,_=G+M+w,O=W-_;if(_<=ee){const a=V.length>0&&g===V[V.length-1].ref.current;i.style.bottom="0px";const h=p.clientHeight-m.offsetTop-m.offsetHeight,C=Math.max(ae,le+(a?xe:0)+h+K),S=_+C;i.style.height=S+"px"}else{const a=V.length>0&&g===V[0].ref.current;i.style.top="0px";const C=Math.max(ee,G+m.offsetTop+(a?ue:0)+le)+O;i.style.height=C+"px",m.scrollTop=_-ee+m.offsetTop}i.style.margin=`${Y}px 0`,i.style.minHeight=Q+"px",i.style.maxHeight=H+"px",d?.(),requestAnimationFrame(()=>I.current=!0)}},[y,u.trigger,u.valueNode,i,p,m,g,x,u.dir,d]);ne(()=>j(),[j]);const[B,R]=s.useState();ne(()=>{p&&R(window.getComputedStyle(p).zIndex)},[p]);const Z=s.useCallback(P=>{P&&N.current===!0&&(j(),f?.(),N.current=!1)},[j,f]);return e.jsx(Zs,{scope:n,contentWrapper:i,shouldExpandOnScrollRef:I,onScrollButtonChange:Z,children:e.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:B},children:e.jsx(D.div,{...r,ref:v,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});yt.displayName=qs;var Ys="SelectPopperPosition",ze=s.forwardRef((t,o)=>{const{__scopeSelect:n,align:d="start",collisionPadding:r=Y,...u}=t,l=Ee(n);return e.jsx(ws,{...l,...u,ref:o,align:d,collisionPadding:r,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});ze.displayName=Ys;var[Zs,Fe]=fe(me,{}),Me="SelectViewport",Nt=s.forwardRef((t,o)=>{const{__scopeSelect:n,nonce:d,...r}=t,u=oe(Me,n),l=Fe(Me,n),i=q(o,u.onViewportChange),c=s.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),e.jsx(Pe.Slot,{scope:n,children:e.jsx(D.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:L(r.onScroll,p=>{const b=p.currentTarget,{contentWrapper:v,shouldExpandOnScrollRef:y}=l;if(y?.current&&v){const I=Math.abs(c.current-b.scrollTop);if(I>0){const N=window.innerHeight-Y*2,m=parseFloat(v.style.minHeight),g=parseFloat(v.style.height),x=Math.max(m,g);if(x<N){const f=x+I,j=Math.min(N,f),B=f-j;v.style.height=j+"px",v.style.bottom==="0px"&&(b.scrollTop=B>0?B:0,v.style.justifyContent="flex-end")}}}c.current=b.scrollTop})})})]})});Nt.displayName=Me;var St="SelectGroup",[Xs,Js]=fe(St),Qs=s.forwardRef((t,o)=>{const{__scopeSelect:n,...d}=t,r=$e();return e.jsx(Xs,{scope:n,id:r,children:e.jsx(D.div,{role:"group","aria-labelledby":r,...d,ref:o})})});Qs.displayName=St;var Ct="SelectLabel",It=s.forwardRef((t,o)=>{const{__scopeSelect:n,...d}=t,r=Js(Ct,n);return e.jsx(D.div,{id:r.id,...d,ref:o})});It.displayName=Ct;var Re="SelectItem",[en,kt]=fe(Re),Rt=s.forwardRef((t,o)=>{const{__scopeSelect:n,value:d,disabled:r=!1,textValue:u,...l}=t,i=re(Re,n),c=oe(Re,n),p=i.value===d,[b,v]=s.useState(u??""),[y,I]=s.useState(!1),N=q(o,f=>c.itemRefCallback?.(f,d,r)),m=$e(),g=s.useRef("touch"),x=()=>{r||(i.onValueChange(d),i.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(en,{scope:n,value:d,disabled:r,textId:m,isSelected:p,onItemTextChange:s.useCallback(f=>{v(j=>j||(f?.textContent??"").trim())},[]),children:e.jsx(Pe.ItemSlot,{scope:n,value:d,disabled:r,textValue:b,children:e.jsx(D.div,{role:"option","aria-labelledby":m,"data-highlighted":y?"":void 0,"aria-selected":p&&y,"data-state":p?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...l,ref:N,onFocus:L(l.onFocus,()=>I(!0)),onBlur:L(l.onBlur,()=>I(!1)),onClick:L(l.onClick,()=>{g.current!=="mouse"&&x()}),onPointerUp:L(l.onPointerUp,()=>{g.current==="mouse"&&x()}),onPointerDown:L(l.onPointerDown,f=>{g.current=f.pointerType}),onPointerMove:L(l.onPointerMove,f=>{g.current=f.pointerType,r?c.onItemLeave?.():g.current==="mouse"&&f.currentTarget.focus({preventScroll:!0})}),onPointerLeave:L(l.onPointerLeave,f=>{f.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:L(l.onKeyDown,f=>{c.searchRef?.current!==""&&f.key===" "||(Bs.includes(f.key)&&x(),f.key===" "&&f.preventDefault())})})})})});Rt.displayName=Re;var we="SelectItemText",Pt=s.forwardRef((t,o)=>{const{__scopeSelect:n,className:d,style:r,...u}=t,l=re(we,n),i=oe(we,n),c=kt(we,n),p=Vs(we,n),[b,v]=s.useState(null),y=q(o,x=>v(x),c.onItemTextChange,x=>i.itemTextRefCallback?.(x,c.value,c.disabled)),I=b?.textContent,N=s.useMemo(()=>e.jsx("option",{value:c.value,disabled:c.disabled,children:I},c.value),[c.disabled,c.value,I]),{onNativeOptionAdd:m,onNativeOptionRemove:g}=p;return ne(()=>(m(N),()=>g(N)),[m,g,N]),e.jsxs(e.Fragment,{children:[e.jsx(D.span,{id:c.textId,...u,ref:y}),c.isSelected&&l.valueNode&&!l.valueNodeHasChildren?nt.createPortal(u.children,l.valueNode):null]})});Pt.displayName=we;var Tt="SelectItemIndicator",Et=s.forwardRef((t,o)=>{const{__scopeSelect:n,...d}=t;return kt(Tt,n).isSelected?e.jsx(D.span,{"aria-hidden":!0,...d,ref:o}):null});Et.displayName=Tt;var Oe="SelectScrollUpButton",_t=s.forwardRef((t,o)=>{const n=oe(Oe,t.__scopeSelect),d=Fe(Oe,t.__scopeSelect),[r,u]=s.useState(!1),l=q(o,d.onScrollButtonChange);return ne(()=>{if(n.viewport&&n.isPositioned){let i=function(){const p=c.scrollTop>0;u(p)};const c=n.viewport;return i(),c.addEventListener("scroll",i),()=>c.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),r?e.jsx(At,{...t,ref:l,onAutoScroll:()=>{const{viewport:i,selectedItem:c}=n;i&&c&&(i.scrollTop=i.scrollTop-c.offsetHeight)}}):null});_t.displayName=Oe;var De="SelectScrollDownButton",Lt=s.forwardRef((t,o)=>{const n=oe(De,t.__scopeSelect),d=Fe(De,t.__scopeSelect),[r,u]=s.useState(!1),l=q(o,d.onScrollButtonChange);return ne(()=>{if(n.viewport&&n.isPositioned){let i=function(){const p=c.scrollHeight-c.clientHeight,b=Math.ceil(c.scrollTop)<p;u(b)};const c=n.viewport;return i(),c.addEventListener("scroll",i),()=>c.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),r?e.jsx(At,{...t,ref:l,onAutoScroll:()=>{const{viewport:i,selectedItem:c}=n;i&&c&&(i.scrollTop=i.scrollTop+c.offsetHeight)}}):null});Lt.displayName=De;var At=s.forwardRef((t,o)=>{const{__scopeSelect:n,onAutoScroll:d,...r}=t,u=oe("SelectScrollButton",n),l=s.useRef(null),i=Te(n),c=s.useCallback(()=>{l.current!==null&&(window.clearInterval(l.current),l.current=null)},[]);return s.useEffect(()=>()=>c(),[c]),ne(()=>{i().find(b=>b.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),e.jsx(D.div,{"aria-hidden":!0,...r,ref:o,style:{flexShrink:0,...r.style},onPointerDown:L(r.onPointerDown,()=>{l.current===null&&(l.current=window.setInterval(d,50))}),onPointerMove:L(r.onPointerMove,()=>{u.onItemLeave?.(),l.current===null&&(l.current=window.setInterval(d,50))}),onPointerLeave:L(r.onPointerLeave,()=>{c()})})}),tn="SelectSeparator",zt=s.forwardRef((t,o)=>{const{__scopeSelect:n,...d}=t;return e.jsx(D.div,{"aria-hidden":!0,...d,ref:o})});zt.displayName=tn;var Be="SelectArrow",sn=s.forwardRef((t,o)=>{const{__scopeSelect:n,...d}=t,r=Ee(n),u=re(Be,n),l=oe(Be,n);return u.open&&l.position==="popper"?e.jsx(js,{...r,...d,ref:o}):null});sn.displayName=Be;var nn="SelectBubbleInput",Mt=s.forwardRef(({__scopeSelect:t,value:o,...n},d)=>{const r=s.useRef(null),u=q(d,r),l=ot(o);return s.useEffect(()=>{const i=r.current;if(!i)return;const c=window.HTMLSelectElement.prototype,b=Object.getOwnPropertyDescriptor(c,"value").set;if(l!==o&&b){const v=new Event("change",{bubbles:!0});b.call(i,o),i.dispatchEvent(v)}},[l,o]),e.jsx(D.select,{...n,style:{...bs,...n.style},ref:u,defaultValue:o})});Mt.displayName=nn;function Ot(t){return t===""||t===void 0}function Dt(t){const o=cs(t),n=s.useRef(""),d=s.useRef(0),r=s.useCallback(l=>{const i=n.current+l;o(i),function c(p){n.current=p,window.clearTimeout(d.current),p!==""&&(d.current=window.setTimeout(()=>c(""),1e3))}(i)},[o]),u=s.useCallback(()=>{n.current="",window.clearTimeout(d.current)},[]);return s.useEffect(()=>()=>window.clearTimeout(d.current),[]),[n,r,u]}function Bt(t,o,n){const r=o.length>1&&Array.from(o).every(p=>p===o[0])?o[0]:o,u=n?t.indexOf(n):-1;let l=rn(t,Math.max(u,0));r.length===1&&(l=l.filter(p=>p!==n));const c=l.find(p=>p.textValue.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function rn(t,o){return t.map((n,d)=>t[(o+d)%t.length])}var on=ut,$t=pt,an=gt,ln=xt,cn=bt,Ut=vt,dn=Nt,Ft=It,Vt=Rt,mn=Pt,un=Et,Ht=_t,Gt=Lt,Wt=zt;const hn=on,pn=an,Kt=s.forwardRef(({className:t,children:o,...n},d)=>e.jsxs($t,{ref:d,className:J("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[o,e.jsx(ln,{asChild:!0,children:e.jsx(at,{className:"h-4 w-4 opacity-50"})})]}));Kt.displayName=$t.displayName;const qt=s.forwardRef(({className:t,...o},n)=>e.jsx(Ht,{ref:n,className:J("flex cursor-default items-center justify-center py-1",t),...o,children:e.jsx(it,{className:"h-4 w-4"})}));qt.displayName=Ht.displayName;const Yt=s.forwardRef(({className:t,...o},n)=>e.jsx(Gt,{ref:n,className:J("flex cursor-default items-center justify-center py-1",t),...o,children:e.jsx(at,{className:"h-4 w-4"})}));Yt.displayName=Gt.displayName;const Zt=s.forwardRef(({className:t,children:o,position:n="popper",...d},r)=>e.jsx(cn,{children:e.jsxs(Ut,{ref:r,className:J("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...d,children:[e.jsx(qt,{}),e.jsx(dn,{className:J("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),e.jsx(Yt,{})]})}));Zt.displayName=Ut.displayName;const fn=s.forwardRef(({className:t,...o},n)=>e.jsx(Ft,{ref:n,className:J("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...o}));fn.displayName=Ft.displayName;const Xt=s.forwardRef(({className:t,children:o,...n},d)=>e.jsxs(Vt,{ref:d,className:J("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(un,{children:e.jsx(lt,{className:"h-4 w-4"})})}),e.jsx(mn,{children:o})]}));Xt.displayName=Vt.displayName;const gn=s.forwardRef(({className:t,...o},n)=>e.jsx(Wt,{ref:n,className:J("-mx-1 my-1 h-px bg-muted",t),...o}));gn.displayName=Wt.displayName;var _e="Checkbox",[xn,Dn]=st(_e),[bn,Ve]=xn(_e);function vn(t){const{__scopeCheckbox:o,checked:n,children:d,defaultChecked:r,disabled:u,form:l,name:i,onCheckedChange:c,required:p,value:b="on",internal_do_not_use_render:v}=t,[y,I]=Ae({prop:n,defaultProp:r??!1,onChange:c,caller:_e}),[N,m]=s.useState(null),[g,x]=s.useState(null),f=s.useRef(!1),j=N?!!l||!!N.closest("form"):!0,B={checked:y,disabled:u,setChecked:I,control:N,setControl:m,name:i,form:l,value:b,hasConsumerStoppedPropagationRef:f,required:p,defaultChecked:se(r)?!1:r,isFormControl:j,bubbleInput:g,setBubbleInput:x};return e.jsx(bn,{scope:o,...B,children:wn(v)?v(B):d})}var Jt="CheckboxTrigger",Qt=s.forwardRef(({__scopeCheckbox:t,onKeyDown:o,onClick:n,...d},r)=>{const{control:u,value:l,disabled:i,checked:c,required:p,setControl:b,setChecked:v,hasConsumerStoppedPropagationRef:y,isFormControl:I,bubbleInput:N}=Ve(Jt,t),m=q(r,b),g=s.useRef(c);return s.useEffect(()=>{const x=u?.form;if(x){const f=()=>v(g.current);return x.addEventListener("reset",f),()=>x.removeEventListener("reset",f)}},[u,v]),e.jsx(D.button,{type:"button",role:"checkbox","aria-checked":se(c)?"mixed":c,"aria-required":p,"data-state":rs(c),"data-disabled":i?"":void 0,disabled:i,value:l,...d,ref:m,onKeyDown:L(o,x=>{x.key==="Enter"&&x.preventDefault()}),onClick:L(n,x=>{v(f=>se(f)?!0:!f),N&&I&&(y.current=x.isPropagationStopped(),y.current||x.stopPropagation())})})});Qt.displayName=Jt;var He=s.forwardRef((t,o)=>{const{__scopeCheckbox:n,name:d,checked:r,defaultChecked:u,required:l,disabled:i,value:c,onCheckedChange:p,form:b,...v}=t;return e.jsx(vn,{__scopeCheckbox:n,checked:r,defaultChecked:u,disabled:i,required:l,onCheckedChange:p,name:d,form:b,value:c,internal_do_not_use_render:({isFormControl:y})=>e.jsxs(e.Fragment,{children:[e.jsx(Qt,{...v,ref:o,__scopeCheckbox:n}),y&&e.jsx(ns,{__scopeCheckbox:n})]})})});He.displayName=_e;var es="CheckboxIndicator",ts=s.forwardRef((t,o)=>{const{__scopeCheckbox:n,forceMount:d,...r}=t,u=Ve(es,n);return e.jsx(gs,{present:d||se(u.checked)||u.checked===!0,children:e.jsx(D.span,{"data-state":rs(u.checked),"data-disabled":u.disabled?"":void 0,...r,ref:o,style:{pointerEvents:"none",...t.style}})})});ts.displayName=es;var ss="CheckboxBubbleInput",ns=s.forwardRef(({__scopeCheckbox:t,...o},n)=>{const{control:d,hasConsumerStoppedPropagationRef:r,checked:u,defaultChecked:l,required:i,disabled:c,name:p,value:b,form:v,bubbleInput:y,setBubbleInput:I}=Ve(ss,t),N=q(n,I),m=ot(u),g=ys(d);s.useEffect(()=>{const f=y;if(!f)return;const j=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(j,"checked").set,Z=!r.current;if(m!==u&&R){const P=new Event("click",{bubbles:Z});f.indeterminate=se(u),R.call(f,se(u)?!1:u),f.dispatchEvent(P)}},[y,m,u,r]);const x=s.useRef(se(u)?!1:u);return e.jsx(D.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??x.current,required:i,disabled:c,name:p,value:b,form:v,...o,tabIndex:-1,ref:N,style:{...o.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ns.displayName=ss;function wn(t){return typeof t=="function"}function se(t){return t==="indeterminate"}function rs(t){return se(t)?"indeterminate":t?"checked":"unchecked"}const os=s.forwardRef(({className:t,...o},n)=>e.jsx(He,{ref:n,className:J("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...o,children:e.jsx(ts,{className:J("flex items-center justify-center text-current"),children:e.jsx(lt,{className:"h-4 w-4"})})}));os.displayName=He.displayName;const jn=s.memo(({image:t,isOpen:o,onClose:n})=>{const d=s.useCallback(async()=>{if(t?.url)try{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){window.open(t.url,"_blank");return}const u=await fetch(t.url);if(!u.ok)throw new Error("Failed to fetch image");const l=await u.blob(),i=window.URL.createObjectURL(l),c=document.createElement("a");c.href=i,c.download=t.filename||`character-image-${Date.now()}.png`,c.target="_blank",document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),window.URL.revokeObjectURL(i)},100)}catch(r){console.error("Failed to download image:",r),window.open(t.url,"_blank")}},[t]);return!o||!t?null:e.jsx("div",{className:"fixed inset-0 z-[999999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-2 sm:p-4",style:{zIndex:999999},onClick:n,children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center image-modal-container",style:{maxWidth:"calc(100vw - 16px)",maxHeight:"calc(100vh - 16px)"},children:[e.jsx("button",{onClick:n,className:"absolute top-2 right-2 z-10 w-8 h-8 sm:w-10 sm:h-10 bg-black/80 hover:bg-black text-white rounded-full flex items-center justify-center transition-colors duration-200 border border-white/20",children:e.jsx(mt,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:d,className:"absolute top-2 right-12 sm:right-16 z-10 w-8 h-8 sm:w-10 sm:h-10 bg-orange-500/80 hover:bg-orange-500 text-white rounded-full flex items-center justify-center transition-colors duration-200 border border-orange-500/40",children:e.jsx(Ue,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("img",{src:t.url,alt:"Generated character image",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl image-modal-image cursor-zoom-in",style:{maxWidth:"calc(100vw - 80px)",maxHeight:"calc(100vh - 80px)",width:"auto",height:"auto",minWidth:"320px",minHeight:"200px"},onClick:r=>r.stopPropagation()})]})})}),yn=s.memo(()=>e.jsxs("div",{className:"flex-shrink-0 w-48 sm:w-56 lg:w-64 h-64 sm:h-72 lg:h-80 relative overflow-hidden rounded-lg bg-gradient-to-br from-zinc-800 via-zinc-700 to-zinc-800 border border-orange-500/30",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-zinc-600/30 to-transparent animate-pulse"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-zinc-400",children:[e.jsx(Ps,{className:"w-8 sm:w-10 lg:w-12 h-8 sm:h-10 lg:h-12 mb-3 sm:mb-4 animate-spin text-orange-500"}),e.jsx("div",{className:"text-sm sm:text-base lg:text-lg font-medium mb-1 sm:mb-2",children:"Generating Image"}),e.jsx("div",{className:"text-xs sm:text-sm text-zinc-500",children:"Please wait..."})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-shimmer"})]})),Nn=s.memo(({image:t,onImageClick:o})=>{const[n,d]=s.useState(!1);if(t.isBuffer)return e.jsx(yn,{});const r=s.useCallback(l=>{d(!0)},[]),u=s.useCallback(async l=>{l.stopPropagation();try{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){window.open(t.url,"_blank");return}const c=await fetch(t.url);if(!c.ok)throw new Error("Failed to fetch image");const p=await c.blob(),b=window.URL.createObjectURL(p),v=document.createElement("a");v.href=b,v.download=t.filename||`character-image-${Date.now()}.png`,v.target="_blank",document.body.appendChild(v),v.click(),setTimeout(()=>{document.body.removeChild(v),window.URL.revokeObjectURL(b)},100)}catch(i){console.error("Failed to download image:",i),window.open(t.url,"_blank")}},[t]);return e.jsxs("div",{className:"flex-shrink-0 w-48 sm:w-56 lg:w-64 h-64 sm:h-72 lg:h-80 group relative cursor-pointer overflow-hidden rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-xl hover:shadow-orange-500/20 border border-zinc-600/30 hover:border-orange-500/50",onClick:()=>o(t),children:[!n&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-zinc-800 via-zinc-700 to-zinc-800 animate-pulse rounded-lg"}),e.jsx("img",{src:t.url,alt:"Generated character image",className:`w-full h-full object-cover transition-all duration-300 ${n?"opacity-100":"opacity-0"} group-hover:scale-105`,onLoad:r,onError:()=>d(!0),loading:"lazy",decoding:"async"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-300 flex items-center justify-center",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex gap-2 sm:gap-3",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),o(t)},className:"w-10 sm:w-12 h-10 sm:h-12 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110",children:e.jsx(Rs,{className:"w-5 sm:w-6 h-5 sm:h-6"})}),e.jsx("button",{onClick:u,className:"w-10 sm:w-12 h-10 sm:h-12 bg-orange-500/80 hover:bg-orange-500 backdrop-blur-sm border border-orange-500/40 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110",children:e.jsx(Ue,{className:"w-4 sm:w-5 h-4 sm:h-5"})})]})})]})}),Sn=({images:t,title:o,onImageClick:n})=>{const[d,r]=s.useState(null),[u,l]=s.useState(!1),[i,c]=s.useState(0),p=s.useRef(null),b=s.useCallback(m=>{m.isBuffer||(n?n(m):(r(m),l(!0)))},[n]),v=s.useCallback(()=>{l(!1),r(null)},[]),y=s.useCallback(m=>{if(!p.current)return;const g=p.current;let x=200;window.innerWidth>=640&&(x=240),window.innerWidth>=1024&&(x=280);const f=m==="left"?Math.max(0,i-x):Math.min(g.scrollWidth-g.clientWidth,i+x);g.scrollTo({left:f,behavior:"smooth"}),c(f)},[i]);if(s.useEffect(()=>{const m=p.current;if(!m)return;const g=()=>{c(m.scrollLeft)};return m.addEventListener("scroll",g),()=>m.removeEventListener("scroll",g)},[]),!t||t.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-zinc-400 text-lg",children:"No images generated yet"}),e.jsx("div",{className:"text-zinc-500 text-sm mt-2",children:"Start generating to see your character images here"})]});const I=i>0,N=p.current?i<p.current.scrollWidth-p.current.clientWidth:!1;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[o&&e.jsxs("h3",{className:"text-xl font-semibold text-zinc-200 mb-4 flex items-center gap-2",children:[o,e.jsxs("span",{className:"text-orange-400",children:["(",t.length,")"]})]}),I&&e.jsx("button",{onClick:()=>y("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-black/80 hover:bg-black/90 backdrop-blur-sm border border-white/20 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110 shadow-lg",children:e.jsx(ct,{className:"w-5 h-5"})}),N&&e.jsx("button",{onClick:()=>y("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-black/80 hover:bg-black/90 backdrop-blur-sm border border-white/20 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110 shadow-lg",children:e.jsx(dt,{className:"w-5 h-5"})}),e.jsx("div",{ref:p,className:"flex gap-4 overflow-x-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:t.map((m,g)=>e.jsx(Nn,{image:m,onImageClick:b},m.id||m.url||`image-${g}`))})]}),e.jsx(jn,{image:d,isOpen:u,onClose:v})]})},Cn=s.memo(Sn),Bn=()=>{const{user:t}=Ns(),o=Ls(),[n]=As(),{toast:d}=Ss(),[r,u]=s.useState(""),[l,i]=s.useState(""),[c,p]=s.useState(""),[b,v]=s.useState(1),[y,I]=s.useState([]),[N,m]=s.useState([]),[g,x]=s.useState(!1),[f,j]=s.useState(0),[B,R]=s.useState(null),[Z,P]=s.useState(null),[$,F]=s.useState(!1),[z,V]=s.useState([]),[H,X]=s.useState(!1),[T,G]=s.useState(null);s.useEffect(()=>{const a=new URLSearchParams(window.location.search),h=a.get("characterId"),C=a.get("returnFromGallery");if(h&&(u(h),C==="true")){const S=localStorage.getItem("generate-images-prompt"),A=localStorage.getItem("generate-images-negative-prompt"),U=localStorage.getItem("generate-images-number");S&&i(S),A&&p(A),U&&v(parseInt(U,10)),localStorage.removeItem("generate-images-prompt"),localStorage.removeItem("generate-images-negative-prompt"),localStorage.removeItem("generate-images-number");const ie=new URL(window.location.href);ie.searchParams.delete("returnFromGallery"),window.history.replaceState({},"",ie.toString())}},[n]),s.useEffect(()=>{I([])},[r]),s.useEffect(()=>()=>{B&&(console.log("🧹 Component unmounting, canceling current job"),x(!1),R(null))},[]);const{data:M=[],isLoading:K}=Ie({queryKey:["characters"],queryFn:async()=>await(await pe("GET","/api/characters?limit=1000",void 0,{},"medium")).json()}),{data:E}=Ie({queryKey:["character",r],queryFn:async()=>await(await pe("GET",`/api/characters/${r}`,void 0,{},"medium")).json(),enabled:!!r}),{data:W}=Ie({queryKey:["character-embeddings",r],queryFn:async()=>{const h=await(await pe("GET",`/api/image-generation/embeddings/${r}`,void 0,{},"medium")).json();return{isReady:h.data?.hasEmbeddings||!1,status:h.data?.status||"unknown",totalImages:h.data?.totalImages||0,message:h.data?.message||"Checking..."}},enabled:!!r}),{data:Q=[],isLoading:ge}=Ie({queryKey:["character-images",r],queryFn:async()=>((await(await pe("GET",`/api/image-generation/character/${r}`,void 0,{},"medium")).json()).data?.images||[]).reverse(),enabled:!!r,refetchInterval:3e4}),ue={1:6,2:12,4:24,8:35},xe=async()=>{if(!E||!l.trim()||!t)return;const a=tt.isUserRestricted(t.id.toString());if(a.isRestricted){let S="";switch(a.type){case"banned":S="Your account has been permanently banned for severe content violations. This action cannot be reversed.";break;case"suspended":S=`Your account is suspended until ${a.expiresAt?.toLocaleString()}. Reason: ${a.reason}`;break;case"restricted":S=`Your account is restricted until ${a.expiresAt?.toLocaleString()}. You cannot generate images during this time.`;break;default:S="Your account has been restricted due to content violations."}d({title:"Account Restricted",description:S,variant:"destructive"});return}const h=Ms(l);if(!h.isAllowed){tt.logViolation({userId:t.id.toString(),username:t.username,violationType:"content_filter",severity:h.severity,content:l,blockedWords:h.blockedWords,context:"image_generation",userAgent:navigator.userAgent}),d({title:h.severity===Os.CRITICAL?"Account Banned":"Content Blocked",description:h.message,variant:"destructive"}),P(h.message||null),F(!0),h.shouldBan&&setTimeout(()=>{d({title:"Account Terminated",description:"Your account has been permanently terminated. You will be redirected shortly.",variant:"destructive"})},2e3);return}if(P(null),F(!1),g){console.log("⚠️ Generation already in progress, please wait...");return}x(!0),j(1);const C={id:`buffer-${Date.now()}`,isBuffer:!0};m([C]);try{const S=E.artStyle?.primaryStyle||"anime",A=E.imageGeneration?.model||null;console.log("🎨 Using character art style:",S),console.log("🤖 Using character model:",A),console.log(`🖼️ Generating ${b} images...`);const U=z.map(te=>({name:te.name,strength:te.strength})),je=await(await pe("POST","/api/image-generation/generate",{prompt:l,negativePrompt:c,characterId:r,characterName:E.name,characterPersona:E.persona,width:1024,height:1536,steps:25,cfgScale:8,artStyle:S,model:A,nsfw:E.isNsfw||!1,quantity:b,loras:U})).json();if(je.success&&je.data){const te=je.data.jobId;R(te),console.log(`✅ Image generation job started: ${te}`);let be=0;const Le=150;let ve=!0;const Ge=async()=>{if(!ve){console.log("⚠️ Polling cancelled for job:",te);return}console.log(`🔍 Polling job ${te} - attempt ${be+1}/${Le}`);try{const We=await(await pe("GET",`/api/image-generation/jobs/${te}`,void 0,{},"low")).json();if(We.success){const ce=We.data;if(ce.status==="completed"&&ce.result){ve=!1;const he=ce.result.imageUrls||[ce.result.imageUrl];m([]),I(Ne=>[...he,...Ne]),console.log(`✅ Generated ${he.length} new images successfully. Total generated: ${he.length+y.length}`),x(!1),j(0),R(null),o.invalidateQueries({queryKey:["character-images",r]});return}else if(ce.status==="failed"){ve=!1,console.error("❌ Image generation failed:",ce.error),x(!1),j(0),R(null),m([]);return}else{const he=ce.progress||0,Ne=Math.max(1,Math.ceil(he*b/100));j(Ne),console.log(`🔄 Generation progress: ${he}% (${Ne}/${b})`)}}}catch(ye){console.error("❌ Error polling job status:",ye)}if(be++,be<Le&&ve){const ye=Math.min(3e3+be*500,1e4);setTimeout(Ge,ye)}else ve=!1,be>=Le&&console.error("❌ Job polling timeout after 5 minutes"),x(!1),j(0),R(null),m([])};setTimeout(Ge,3e3)}else console.error("❌ Image generation failed:",je.error),x(!1),j(0),R(null),m([])}catch(S){console.error("❌ Error generating images:",S),x(!1),j(0),R(null),m([])}},ee=ue[b],ae=(a,h)=>{V(h?[{id:a.id,name:a.filename,strength:1}]:[])},le=a=>z.some(h=>h.id===a),w=async(a,h)=>{try{const S=await(await fetch(a)).blob(),A=window.URL.createObjectURL(S),U=document.createElement("a");U.href=A,U.download=h,document.body.appendChild(U),U.click(),document.body.removeChild(U),window.URL.revokeObjectURL(A)}catch(C){console.error("Download failed:",C),window.open(a,"_blank")}},_=(a,h,C)=>{G({image:a,groupImages:h,index:C})},O=()=>{G(null)},k=a=>{if(!T)return;const{groupImages:h,index:C}=T;let S;a==="prev"?S=C>0?C-1:h.length-1:S=C<h.length-1?C+1:0,G({image:h[S],groupImages:h,index:S})};return e.jsx("div",{className:"pb-20 pt-20 fixed inset-0 bg-gradient-to-br from-zinc-900 via-zinc-800 to-orange-900/20 text-white overflow-hidden",children:e.jsxs("div",{className:"flex flex-col h-full overflow-y-auto lg:overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-4 sm:p-6 pb-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsx(et,{href:"/gallery",children:e.jsxs(Ke,{variant:"ghost",size:"sm",className:"text-zinc-400 hover:text-white w-fit",children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),"Back to Gallery"]})}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[e.jsx(Xe,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-semibold",children:[t?.coins||0," coins"]})]})]}),e.jsxs("div",{className:"mt-4 mb-2 max-w-4xl",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent mb-3 leading-tight",children:"AI Image Generator - Create Custom Character Art"}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-zinc-300 text-sm lg:text-base leading-relaxed",children:"Generate stunning AI images and artwork with your favorite characters. Create custom NSFW and SFW images using advanced AI technology."})}),e.jsxs("div",{className:"bg-red-900/20 border border-red-700 p-3 rounded-lg text-xs lg:flex-shrink-0 lg:max-w-xs",children:[e.jsx("h4",{className:"text-red-400 font-semibold text-xs mb-1",children:"⚠️ User Responsibility"}),e.jsxs("p",{className:"text-gray-300 text-xs leading-relaxed",children:["You are ",e.jsx("strong",{children:"100% responsible"})," for all generated content.",e.jsx(et,{href:"/legal/liability-disclaimer",className:"text-blue-400 hover:text-blue-300 underline ml-1 break-words",children:"Read disclaimer"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 lg:gap-6 px-4 sm:px-6 pb-6 mb-0 lg:h-[calc(100vh-120px)] lg:overflow-hidden items-stretch",children:[e.jsx("div",{className:"w-full lg:w-[28rem] flex-shrink-0 flex flex-col lg:h-[65vh]",children:e.jsx(qe,{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border-orange-500/20 flex-1 flex flex-col lg:h-full",children:e.jsxs(Ye,{className:"p-3 sm:p-4 lg:p-2 space-y-3 sm:space-y-4 lg:space-y-1 lg:overflow-y-auto flex-col flex-1 lg:h-full",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 flex-shrink-0",children:[E?e.jsxs("div",{className:"flex items-center gap-3 mb-3 lg:mb-4",children:[e.jsx("img",{src:E.avatar||E.avatarUrl||"/fallback.jpg",alt:E.name,className:"w-10 lg:w-12 h-10 lg:h-12 rounded-full object-cover ring-2 ring-orange-500/30"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"text-base lg:text-lg font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent leading-tight",children:["Generate Images for ",E.name]}),e.jsx("p",{className:"text-zinc-400 text-xs lg:text-sm",children:"Create stunning images"})]})]}):e.jsxs("div",{className:"flex items-center gap-3 mb-3 lg:mb-4",children:[e.jsx("div",{className:"w-10 lg:w-12 h-10 lg:h-12 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center",children:e.jsx(Se,{className:"w-5 lg:w-6 h-5 lg:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base lg:text-lg font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent",children:"Generate Images"}),e.jsx("p",{className:"text-zinc-400 text-xs lg:text-sm",children:"Create stunning images"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 sm:w-5 h-4 sm:h-5 text-orange-400"}),"Select Character"]}),K?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Cs,{size:"sm",text:"Loading characters..."})}):e.jsxs(hn,{value:r,onValueChange:u,children:[e.jsx(Kt,{className:"w-full bg-zinc-800/50 border-zinc-600/30 focus:border-orange-500",children:e.jsx(pn,{placeholder:"Choose a character to generate images with..."})}),e.jsx(Zt,{className:"bg-zinc-800 border-zinc-600/30 max-h-64 overflow-y-auto max-w-[calc(100vw-2rem)] sm:max-w-md",children:M.map(a=>e.jsx(Xt,{value:a.id,className:"focus:bg-orange-500/20 focus:text-orange-300",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("img",{src:a.avatar||a.avatarUrl||"/fallback.jpg",alt:a.name,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}),e.jsx("span",{className:"truncate",children:a.name})]})},a.id))})]})]}),r&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg border border-zinc-600/30 bg-zinc-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:"Character Embedding Status"})]}),W?e.jsx("div",{className:"flex items-center gap-2",children:W.isReady?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm text-green-400",children:"Ready for image generation"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-yellow-400",children:"Image creation will be available in less than 2 minutes"})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-zinc-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-zinc-400",children:"Checking embedding status..."})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 sm:w-5 h-4 sm:h-5 text-orange-400"}),"Prompt"]}),e.jsx(ks,{placeholder:"Describe what you want to see in your image. Tip: Start your prompt with a subject (e.g. A fantasy sorcerer standing in a mystical library...)",value:l,onChange:a=>{const h=a.target.value;if(i(h),h.trim()){const C=zs(h);P(C.isAllowed?null:C.message||null),F(!C.isAllowed)}else P(null),F(!1)},className:`min-h-[100px] sm:min-h-[120px] bg-zinc-800/50 resize-none text-sm lg:text-base transition-colors ${$?"border-red-500 focus:border-red-500":"border-zinc-600 focus:border-orange-500"}`,disabled:!r}),!r&&e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Please select a character first"}),Z&&e.jsxs("div",{className:"mt-2 p-3 bg-red-900/20 border border-red-500/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx(Je,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Content Warning"})]}),e.jsx("p",{className:"text-sm text-red-300 mt-1",children:Z})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-orange-400"}),"LoRA Selection"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>X(!H),disabled:!r,className:`w-full p-2 rounded-lg border-2 transition-all duration-200 flex items-center justify-between ${z.length>0?"border-orange-500 bg-orange-500/20 text-orange-300":"border-zinc-600 hover:border-orange-400 text-zinc-400 hover:text-orange-400"} ${r?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{size:14}),e.jsx("span",{className:"text-xs",children:z.length>0?`${z[0]?.name?ke.find(a=>a.id===z[0].id)?.name:"LoRA"} selected`:"Select a LoRA for image generation"})]}),H?e.jsx(it,{size:14}):e.jsx(Es,{size:14})]}),H&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gradient-to-br from-zinc-800/95 to-zinc-900/95 backdrop-blur-xl border border-orange-500/30 rounded-lg shadow-xl shadow-orange-500/20 z-50 max-h-64 overflow-y-auto",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"text-xs text-zinc-400 mb-2 flex items-center space-x-1",children:[e.jsx(Qe,{size:12}),e.jsxs("span",{children:["Available LoRAs (",ke.length,")"]})]}),e.jsx("div",{className:"space-y-1",children:ke.map(a=>{const h=le(a.id);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{id:`lora-${a.id}`,checked:h,onCheckedChange:C=>ae(a,C),disabled:!r,className:"scale-90"}),e.jsx(Is,{htmlFor:`lora-${a.id}`,className:"text-xs font-medium cursor-pointer",children:a.name})]}),e.jsx("div",{className:"text-xs text-zinc-400 ml-6 mb-2",children:a.description}),h&&e.jsx("div",{className:"ml-6 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-zinc-400",children:"Strength:"}),e.jsx("span",{className:"text-orange-400",children:"100%"})]})})]},a.id)})}),z.length>0&&e.jsx("div",{className:"border-t border-zinc-700/50 mt-3 pt-3",children:e.jsxs("button",{onClick:()=>V([]),className:"w-full text-left px-2 py-1.5 rounded text-xs text-zinc-400 hover:bg-red-500/20 hover:text-red-300 transition-all duration-200 flex items-center space-x-1",children:[e.jsx(_s,{size:10}),e.jsx("span",{children:"Clear All LoRAs"})]})})]})})]}),z.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("div",{className:"text-xs text-zinc-400",children:"Selected LoRA:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:z.map(a=>e.jsxs("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-orange-500/20 border border-orange-500/30 rounded text-xs",children:[e.jsx("span",{className:"text-orange-300",children:ke.find(h=>h.id===a.id)?.name||a.name}),e.jsx("span",{className:"text-zinc-400",children:"(100%)"}),e.jsx("button",{onClick:()=>ae({id:a.id,name:a.name},!1),className:"text-zinc-400 hover:text-red-400 transition-colors ml-1",children:"×"})]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Number of Images"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4",children:Object.entries(ue).map(([a,h])=>e.jsx("button",{onClick:()=>v(parseInt(a)),disabled:!r,className:`p-2 sm:p-1 rounded-lg border-2 transition-all duration-200 ${b===parseInt(a)?"border-orange-500 bg-orange-500/20":"border-zinc-600 hover:border-orange-400"} ${r?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold",children:a}),e.jsxs("div",{className:"text-xs text-zinc-400 flex items-center justify-center gap-1",children:[e.jsx(Xe,{className:"w-2 h-2"}),h]})]})},a))}),e.jsx(Ke,{onClick:xe,disabled:!r||!l.trim()||g||$||(t?.coins||0)<ee||W&&!W.isReady,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold py-3 text-base sm:text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Generating ",f," of ",b,"..."]}):$?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5"}),"Content Blocked - Fix Prompt"]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Generate ",b," Image",b>1?"s":""," (",ee," coins)"]})})]})]})})}),e.jsx("div",{className:"flex-1 min-w-0 order-2 lg:order-2 lg:overflow-hidden flex flex-col lg:h-[65vh] min-h-[400px]",children:e.jsx(qe,{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border-orange-500/20 flex-1 flex flex-col lg:h-full",children:e.jsxs(Ye,{className:"p-3 sm:p-4 flex flex-col flex-1 lg:h-full",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4 flex items-center gap-2 flex-shrink-0",children:[e.jsx(Se,{className:"w-4 sm:w-5 h-4 sm:h-5 text-orange-400"}),"Workshop"]}),e.jsx("div",{className:"flex-1 flex items-center justify-center overflow-hidden",children:y.length===0&&N.length===0&&Q.length===0?e.jsxs("div",{className:"text-center px-4",children:[e.jsx(Se,{className:"w-12 sm:w-16 lg:w-24 h-12 sm:h-16 lg:h-24 mx-auto mb-3 sm:mb-4 lg:mb-6 opacity-30 text-zinc-400"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-3xl font-medium mb-2 lg:mb-4 text-zinc-400",children:"Your Creative Workshop"}),e.jsx("p",{className:"text-sm sm:text-base lg:text-xl mb-2 lg:mb-3 text-zinc-500",children:"Generated images will appear here"}),!r&&e.jsx("p",{className:"text-xs sm:text-sm lg:text-lg text-zinc-600 mt-2 lg:mt-4",children:"Select a character and start creating amazing images"})]}):e.jsx("div",{className:"w-full",children:e.jsx(Cn,{images:[...N.map(a=>({url:"",id:a.id,isBuffer:!0})),...y.map((a,h)=>({url:a,id:`generated-${h}`,filename:`generated-image-${Date.now()}-${h+1}.webp`})),...y.length===0&&N.length===0?Q.slice(0,8).map((a,h)=>({url:a.url,id:`existing-${h}`,filename:a.filename||`character-image-${h+1}.webp`})):[]],title:N.length>0?"Generating Images...":y.length>0?`Generated Images (${y.length})`:Q.length>0?`Character Images (${Q.length})`:void 0,onImageClick:a=>{const h=[...y.map((S,A)=>({url:S,id:`generated-${A}`,filename:`generated-image-${Date.now()}-${A+1}.webp`})),...y.length===0&&N.length===0?Q.slice(0,8).map((S,A)=>({url:S.url,id:`existing-${A}`,filename:S.filename||`character-image-${A+1}.webp`})):[]],C=h.findIndex(S=>S.id===a.id);C!==-1&&_(a,h,C)}})})})]})})})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 sm:p-8",onClick:O,children:e.jsxs("div",{className:"relative bg-zinc-800/90 backdrop-blur-md rounded-lg w-full h-auto max-w-4xl max-h-[90vh] overflow-hidden border border-orange-500/30 flex flex-col",style:{maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 160px)"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-orange-500/20 flex-shrink-0",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-sm sm:text-base truncate",children:"Generated Image"}),e.jsxs("p",{className:"text-zinc-300 text-xs sm:text-sm",children:["Image ",T.index+1," of ",T.groupImages.length]})]}),e.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>w(T.image.url,T.image.filename||`generated-image-${T.index+1}.png`),className:"bg-orange-600 hover:bg-orange-700 text-white p-1.5 sm:p-2 rounded-lg transition-colors",children:e.jsx(Ue,{size:16,className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:O,className:"bg-zinc-700 hover:bg-zinc-600 text-white p-1.5 sm:p-2 rounded-lg transition-colors",children:e.jsx(mt,{size:16,className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsxs("div",{className:"relative flex-1 flex items-center justify-center p-4",children:[e.jsx("img",{src:T.image.url,alt:`Generated image ${T.index+1}`,className:"max-w-full max-h-full object-contain mx-auto block",style:{maxWidth:"calc(100vw - 96px)",maxHeight:"calc(100vh - 240px)"}}),T.groupImages.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k("prev"),className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 bg-black/60 hover:bg-black/80 text-white p-1.5 sm:p-2 rounded-full transition-colors",children:e.jsx(ct,{size:20,className:"w-4 h-4 sm:w-6 sm:h-6"})}),e.jsx("button",{onClick:()=>k("next"),className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 bg-black/60 hover:bg-black/80 text-white p-1.5 sm:p-2 rounded-full transition-colors",children:e.jsx(dt,{size:20,className:"w-4 h-4 sm:w-6 sm:h-6"})})]})]})]})})]})})};export{Bn as default};
