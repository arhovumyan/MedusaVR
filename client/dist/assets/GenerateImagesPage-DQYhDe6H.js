import{E as Mt,b as Ae,j as e,c as Ot,K as Re,a as zt,u as J,h as te,P as U,e as M,g as Dt,f as Bt,L as $t,M as Ut,N as Vt,Q as Ht,U as Wt,D as Ft}from"./ui-vendor-yJ52fMSG.js";import{r as t,b as He}from"./react-vendor-CgzYKCvO.js";import{E as We,R as Gt,V as Kt,G as qt,J as Yt,K as Jt,c as se,u as Qt,d as Zt,B as Me,L as Xt,b as pe}from"./index-14IbRwle.js";import{C as Oe,a as ze}from"./card-5a3nuwiG.js";import{T as es}from"./textarea-B3bvEQax.js";import{u as ts,c as De}from"./index-Bk2AHYaC.js";import{k as Fe,Z as ss,z as ns,aj as Ge,ak as Ke,as as os,Q as Ee,X as qe,u as rs,R as as,j as Be,I as be,v as Ne,T as $e}from"./icons-CPY5GJO9.js";import{u as ls,b as ve}from"./query-vendor-8KRGqY0G.js";import{u as is,L as Ue}from"./routing-DoJeAdmJ.js";import{f as cs,v as Ve,a as ds,V as ms}from"./violation-tracker-CTkv3hWF.js";import"./utils--BulIq_u.js";var us=[" ","Enter","ArrowUp","ArrowDown"],ps=[" ","Enter"],ae="Select",[ye,je,gs]=zt(ae),[ge,an]=Ot(ae,[gs,We]),Se=We(),[hs,ne]=ge(ae),[fs,xs]=ge(ae),Ye=s=>{const{__scopeSelect:r,children:n,open:d,defaultOpen:o,onOpenChange:u,value:a,defaultValue:l,onValueChange:i,dir:p,name:v,autoComplete:j,disabled:C,required:P,form:I}=s,c=Se(r),[x,w]=t.useState(null),[b,y]=t.useState(null),[K,_]=t.useState(!1),X=Mt(p),[L,O]=Ae({prop:d,defaultProp:o??!1,onChange:u,caller:ae}),[D,A]=Ae({prop:a,defaultProp:l,onChange:i,caller:ae}),B=t.useRef(null),H=x?I||!!x.closest("form"):!0,[q,R]=t.useState(new Set),z=Array.from(q).map(E=>E.props.value).join(";");return e.jsx(Gt,{...c,children:e.jsxs(hs,{required:P,scope:r,trigger:x,onTriggerChange:w,valueNode:b,onValueNodeChange:y,valueNodeHasChildren:K,onValueNodeHasChildrenChange:_,contentId:Re(),value:D,onValueChange:A,open:L,onOpenChange:O,dir:X,triggerPointerDownPosRef:B,disabled:C,children:[e.jsx(ye.Provider,{scope:r,children:e.jsx(fs,{scope:s.__scopeSelect,onNativeOptionAdd:t.useCallback(E=>{R(W=>new Set(W).add(E))},[]),onNativeOptionRemove:t.useCallback(E=>{R(W=>{const V=new Set(W);return V.delete(E),V})},[]),children:n})}),H?e.jsxs(vt,{"aria-hidden":!0,required:P,tabIndex:-1,name:v,autoComplete:j,value:D,onChange:E=>A(E.target.value),disabled:C,form:I,children:[D===void 0?e.jsx("option",{value:""}):null,Array.from(q)]},z):null]})})};Ye.displayName=ae;var Je="SelectTrigger",Qe=t.forwardRef((s,r)=>{const{__scopeSelect:n,disabled:d=!1,...o}=s,u=Se(n),a=ne(Je,n),l=a.disabled||d,i=J(r,a.onTriggerChange),p=je(n),v=t.useRef("touch"),[j,C,P]=yt(c=>{const x=p().filter(y=>!y.disabled),w=x.find(y=>y.value===a.value),b=jt(x,c,w);b!==void 0&&a.onValueChange(b.value)}),I=c=>{l||(a.onOpenChange(!0),P()),c&&(a.triggerPointerDownPosRef.current={x:Math.round(c.pageX),y:Math.round(c.pageY)})};return e.jsx(qt,{asChild:!0,...u,children:e.jsx(U.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":wt(a.value)?"":void 0,...o,ref:i,onClick:M(o.onClick,c=>{c.currentTarget.focus(),v.current!=="mouse"&&I(c)}),onPointerDown:M(o.onPointerDown,c=>{v.current=c.pointerType;const x=c.target;x.hasPointerCapture(c.pointerId)&&x.releasePointerCapture(c.pointerId),c.button===0&&c.ctrlKey===!1&&c.pointerType==="mouse"&&(I(c),c.preventDefault())}),onKeyDown:M(o.onKeyDown,c=>{const x=j.current!=="";!(c.ctrlKey||c.altKey||c.metaKey)&&c.key.length===1&&C(c.key),!(x&&c.key===" ")&&us.includes(c.key)&&(I(),c.preventDefault())})})})});Qe.displayName=Je;var Ze="SelectValue",Xe=t.forwardRef((s,r)=>{const{__scopeSelect:n,className:d,style:o,children:u,placeholder:a="",...l}=s,i=ne(Ze,n),{onValueNodeHasChildrenChange:p}=i,v=u!==void 0,j=J(r,i.onValueNodeChange);return te(()=>{p(v)},[p,v]),e.jsx(U.span,{...l,ref:j,style:{pointerEvents:"none"},children:wt(i.value)?e.jsx(e.Fragment,{children:a}):u})});Xe.displayName=Ze;var bs="SelectIcon",et=t.forwardRef((s,r)=>{const{__scopeSelect:n,children:d,...o}=s;return e.jsx(U.span,{"aria-hidden":!0,...o,ref:r,children:d||"▼"})});et.displayName=bs;var vs="SelectPortal",tt=s=>e.jsx(Dt,{asChild:!0,...s});tt.displayName=vs;var le="SelectContent",st=t.forwardRef((s,r)=>{const n=ne(le,s.__scopeSelect),[d,o]=t.useState();if(te(()=>{o(new DocumentFragment)},[]),!n.open){const u=d;return u?He.createPortal(e.jsx(nt,{scope:s.__scopeSelect,children:e.jsx(ye.Slot,{scope:s.__scopeSelect,children:e.jsx("div",{children:s.children})})}),u):null}return e.jsx(ot,{...s,ref:r})});st.displayName=le;var G=10,[nt,oe]=ge(le),ws="SelectContentImpl",ys=Ht("SelectContent.RemoveScroll"),ot=t.forwardRef((s,r)=>{const{__scopeSelect:n,position:d="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:u,onPointerDownOutside:a,side:l,sideOffset:i,align:p,alignOffset:v,arrowPadding:j,collisionBoundary:C,collisionPadding:P,sticky:I,hideWhenDetached:c,avoidCollisions:x,...w}=s,b=ne(le,n),[y,K]=t.useState(null),[_,X]=t.useState(null),L=J(r,m=>K(m)),[O,D]=t.useState(null),[A,B]=t.useState(null),H=je(n),[q,R]=t.useState(!1),z=t.useRef(!1);t.useEffect(()=>{if(y)return $t(y)},[y]),Ut();const E=t.useCallback(m=>{const[h,...k]=H().map(T=>T.ref.current),[S]=k.slice(-1),N=document.activeElement;for(const T of m)if(T===N||(T?.scrollIntoView({block:"nearest"}),T===h&&_&&(_.scrollTop=0),T===S&&_&&(_.scrollTop=_.scrollHeight),T?.focus(),document.activeElement!==N))return},[H,_]),W=t.useCallback(()=>E([O,y]),[E,O,y]);t.useEffect(()=>{q&&W()},[q,W]);const{onOpenChange:V,triggerPointerDownPosRef:Y}=b;t.useEffect(()=>{if(y){let m={x:0,y:0};const h=S=>{m={x:Math.abs(Math.round(S.pageX)-(Y.current?.x??0)),y:Math.abs(Math.round(S.pageY)-(Y.current?.y??0))}},k=S=>{m.x<=10&&m.y<=10?S.preventDefault():y.contains(S.target)||V(!1),document.removeEventListener("pointermove",h),Y.current=null};return Y.current!==null&&(document.addEventListener("pointermove",h),document.addEventListener("pointerup",k,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",k,{capture:!0})}}},[y,V,Y]),t.useEffect(()=>{const m=()=>V(!1);return window.addEventListener("blur",m),window.addEventListener("resize",m),()=>{window.removeEventListener("blur",m),window.removeEventListener("resize",m)}},[V]);const[ie,ce]=yt(m=>{const h=H().filter(N=>!N.disabled),k=h.find(N=>N.ref.current===document.activeElement),S=jt(h,m,k);S&&setTimeout(()=>S.ref.current.focus())}),he=t.useCallback((m,h,k)=>{const S=!z.current&&!k;(b.value!==void 0&&b.value===h||S)&&(D(m),S&&(z.current=!0))},[b.value]),de=t.useCallback(()=>y?.focus(),[y]),Q=t.useCallback((m,h,k)=>{const S=!z.current&&!k;(b.value!==void 0&&b.value===h||S)&&B(m)},[b.value]),g=d==="popper"?Ce:rt,f=g===Ce?{side:l,sideOffset:i,align:p,alignOffset:v,arrowPadding:j,collisionBoundary:C,collisionPadding:P,sticky:I,hideWhenDetached:c,avoidCollisions:x}:{};return e.jsx(nt,{scope:n,content:y,viewport:_,onViewportChange:X,itemRefCallback:he,selectedItem:O,onItemLeave:de,itemTextRefCallback:Q,focusSelectedItem:W,selectedItemText:A,position:d,isPositioned:q,searchRef:ie,children:e.jsx(Vt,{as:ys,allowPinchZoom:!0,children:e.jsx(Wt,{asChild:!0,trapped:b.open,onMountAutoFocus:m=>{m.preventDefault()},onUnmountAutoFocus:M(o,m=>{b.trigger?.focus({preventScroll:!0}),m.preventDefault()}),children:e.jsx(Ft,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:a,onFocusOutside:m=>m.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:e.jsx(g,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:m=>m.preventDefault(),...w,...f,onPlaced:()=>R(!0),ref:L,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:M(w.onKeyDown,m=>{const h=m.ctrlKey||m.altKey||m.metaKey;if(m.key==="Tab"&&m.preventDefault(),!h&&m.key.length===1&&ce(m.key),["ArrowUp","ArrowDown","Home","End"].includes(m.key)){let S=H().filter(N=>!N.disabled).map(N=>N.ref.current);if(["ArrowUp","End"].includes(m.key)&&(S=S.slice().reverse()),["ArrowUp","ArrowDown"].includes(m.key)){const N=m.target,T=S.indexOf(N);S=S.slice(T+1)}setTimeout(()=>E(S)),m.preventDefault()}})})})})})})});ot.displayName=ws;var js="SelectItemAlignedPosition",rt=t.forwardRef((s,r)=>{const{__scopeSelect:n,onPlaced:d,...o}=s,u=ne(le,n),a=oe(le,n),[l,i]=t.useState(null),[p,v]=t.useState(null),j=J(r,L=>v(L)),C=je(n),P=t.useRef(!1),I=t.useRef(!0),{viewport:c,selectedItem:x,selectedItemText:w,focusSelectedItem:b}=a,y=t.useCallback(()=>{if(u.trigger&&u.valueNode&&l&&p&&c&&x&&w){const L=u.trigger.getBoundingClientRect(),O=p.getBoundingClientRect(),D=u.valueNode.getBoundingClientRect(),A=w.getBoundingClientRect();if(u.dir!=="rtl"){const N=A.left-O.left,T=D.left-N,$=L.left-T,F=L.width+$,Z=Math.max(F,O.width),me=window.innerWidth-G,ee=De(T,[G,Math.max(G,me-Z)]);l.style.minWidth=F+"px",l.style.left=ee+"px"}else{const N=O.right-A.right,T=window.innerWidth-D.right-N,$=window.innerWidth-L.right-T,F=L.width+$,Z=Math.max(F,O.width),me=window.innerWidth-G,ee=De(T,[G,Math.max(G,me-Z)]);l.style.minWidth=F+"px",l.style.right=ee+"px"}const B=C(),H=window.innerHeight-G*2,q=c.scrollHeight,R=window.getComputedStyle(p),z=parseInt(R.borderTopWidth,10),E=parseInt(R.paddingTop,10),W=parseInt(R.borderBottomWidth,10),V=parseInt(R.paddingBottom,10),Y=z+E+q+V+W,ie=Math.min(x.offsetHeight*5,Y),ce=window.getComputedStyle(c),he=parseInt(ce.paddingTop,10),de=parseInt(ce.paddingBottom,10),Q=L.top+L.height/2-G,g=H-Q,f=x.offsetHeight/2,m=x.offsetTop+f,h=z+E+m,k=Y-h;if(h<=Q){const N=B.length>0&&x===B[B.length-1].ref.current;l.style.bottom="0px";const T=p.clientHeight-c.offsetTop-c.offsetHeight,$=Math.max(g,f+(N?de:0)+T+W),F=h+$;l.style.height=F+"px"}else{const N=B.length>0&&x===B[0].ref.current;l.style.top="0px";const $=Math.max(Q,z+c.offsetTop+(N?he:0)+f)+k;l.style.height=$+"px",c.scrollTop=h-Q+c.offsetTop}l.style.margin=`${G}px 0`,l.style.minHeight=ie+"px",l.style.maxHeight=H+"px",d?.(),requestAnimationFrame(()=>P.current=!0)}},[C,u.trigger,u.valueNode,l,p,c,x,w,u.dir,d]);te(()=>y(),[y]);const[K,_]=t.useState();te(()=>{p&&_(window.getComputedStyle(p).zIndex)},[p]);const X=t.useCallback(L=>{L&&I.current===!0&&(y(),b?.(),I.current=!1)},[y,b]);return e.jsx(Ns,{scope:n,contentWrapper:l,shouldExpandOnScrollRef:P,onScrollButtonChange:X,children:e.jsx("div",{ref:i,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:K},children:e.jsx(U.div,{...o,ref:j,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});rt.displayName=js;var Ss="SelectPopperPosition",Ce=t.forwardRef((s,r)=>{const{__scopeSelect:n,align:d="start",collisionPadding:o=G,...u}=s,a=Se(n);return e.jsx(Yt,{...a,...u,ref:r,align:d,collisionPadding:o,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ce.displayName=Ss;var[Ns,_e]=ge(le,{}),Ie="SelectViewport",at=t.forwardRef((s,r)=>{const{__scopeSelect:n,nonce:d,...o}=s,u=oe(Ie,n),a=_e(Ie,n),l=J(r,u.onViewportChange),i=t.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),e.jsx(ye.Slot,{scope:n,children:e.jsx(U.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:M(o.onScroll,p=>{const v=p.currentTarget,{contentWrapper:j,shouldExpandOnScrollRef:C}=a;if(C?.current&&j){const P=Math.abs(i.current-v.scrollTop);if(P>0){const I=window.innerHeight-G*2,c=parseFloat(j.style.minHeight),x=parseFloat(j.style.height),w=Math.max(c,x);if(w<I){const b=w+P,y=Math.min(I,b),K=b-y;j.style.height=y+"px",j.style.bottom==="0px"&&(v.scrollTop=K>0?K:0,j.style.justifyContent="flex-end")}}}i.current=v.scrollTop})})})]})});at.displayName=Ie;var lt="SelectGroup",[Cs,Is]=ge(lt),ks=t.forwardRef((s,r)=>{const{__scopeSelect:n,...d}=s,o=Re();return e.jsx(Cs,{scope:n,id:o,children:e.jsx(U.div,{role:"group","aria-labelledby":o,...d,ref:r})})});ks.displayName=lt;var it="SelectLabel",ct=t.forwardRef((s,r)=>{const{__scopeSelect:n,...d}=s,o=Is(it,n);return e.jsx(U.div,{id:o.id,...d,ref:r})});ct.displayName=it;var we="SelectItem",[Ts,dt]=ge(we),mt=t.forwardRef((s,r)=>{const{__scopeSelect:n,value:d,disabled:o=!1,textValue:u,...a}=s,l=ne(we,n),i=oe(we,n),p=l.value===d,[v,j]=t.useState(u??""),[C,P]=t.useState(!1),I=J(r,b=>i.itemRefCallback?.(b,d,o)),c=Re(),x=t.useRef("touch"),w=()=>{o||(l.onValueChange(d),l.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(Ts,{scope:n,value:d,disabled:o,textId:c,isSelected:p,onItemTextChange:t.useCallback(b=>{j(y=>y||(b?.textContent??"").trim())},[]),children:e.jsx(ye.ItemSlot,{scope:n,value:d,disabled:o,textValue:v,children:e.jsx(U.div,{role:"option","aria-labelledby":c,"data-highlighted":C?"":void 0,"aria-selected":p&&C,"data-state":p?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...a,ref:I,onFocus:M(a.onFocus,()=>P(!0)),onBlur:M(a.onBlur,()=>P(!1)),onClick:M(a.onClick,()=>{x.current!=="mouse"&&w()}),onPointerUp:M(a.onPointerUp,()=>{x.current==="mouse"&&w()}),onPointerDown:M(a.onPointerDown,b=>{x.current=b.pointerType}),onPointerMove:M(a.onPointerMove,b=>{x.current=b.pointerType,o?i.onItemLeave?.():x.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:M(a.onPointerLeave,b=>{b.currentTarget===document.activeElement&&i.onItemLeave?.()}),onKeyDown:M(a.onKeyDown,b=>{i.searchRef?.current!==""&&b.key===" "||(ps.includes(b.key)&&w(),b.key===" "&&b.preventDefault())})})})})});mt.displayName=we;var fe="SelectItemText",ut=t.forwardRef((s,r)=>{const{__scopeSelect:n,className:d,style:o,...u}=s,a=ne(fe,n),l=oe(fe,n),i=dt(fe,n),p=xs(fe,n),[v,j]=t.useState(null),C=J(r,w=>j(w),i.onItemTextChange,w=>l.itemTextRefCallback?.(w,i.value,i.disabled)),P=v?.textContent,I=t.useMemo(()=>e.jsx("option",{value:i.value,disabled:i.disabled,children:P},i.value),[i.disabled,i.value,P]),{onNativeOptionAdd:c,onNativeOptionRemove:x}=p;return te(()=>(c(I),()=>x(I)),[c,x,I]),e.jsxs(e.Fragment,{children:[e.jsx(U.span,{id:i.textId,...u,ref:C}),i.isSelected&&a.valueNode&&!a.valueNodeHasChildren?He.createPortal(u.children,a.valueNode):null]})});ut.displayName=fe;var pt="SelectItemIndicator",gt=t.forwardRef((s,r)=>{const{__scopeSelect:n,...d}=s;return dt(pt,n).isSelected?e.jsx(U.span,{"aria-hidden":!0,...d,ref:r}):null});gt.displayName=pt;var ke="SelectScrollUpButton",ht=t.forwardRef((s,r)=>{const n=oe(ke,s.__scopeSelect),d=_e(ke,s.__scopeSelect),[o,u]=t.useState(!1),a=J(r,d.onScrollButtonChange);return te(()=>{if(n.viewport&&n.isPositioned){let l=function(){const p=i.scrollTop>0;u(p)};const i=n.viewport;return l(),i.addEventListener("scroll",l),()=>i.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),o?e.jsx(xt,{...s,ref:a,onAutoScroll:()=>{const{viewport:l,selectedItem:i}=n;l&&i&&(l.scrollTop=l.scrollTop-i.offsetHeight)}}):null});ht.displayName=ke;var Te="SelectScrollDownButton",ft=t.forwardRef((s,r)=>{const n=oe(Te,s.__scopeSelect),d=_e(Te,s.__scopeSelect),[o,u]=t.useState(!1),a=J(r,d.onScrollButtonChange);return te(()=>{if(n.viewport&&n.isPositioned){let l=function(){const p=i.scrollHeight-i.clientHeight,v=Math.ceil(i.scrollTop)<p;u(v)};const i=n.viewport;return l(),i.addEventListener("scroll",l),()=>i.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),o?e.jsx(xt,{...s,ref:a,onAutoScroll:()=>{const{viewport:l,selectedItem:i}=n;l&&i&&(l.scrollTop=l.scrollTop+i.offsetHeight)}}):null});ft.displayName=Te;var xt=t.forwardRef((s,r)=>{const{__scopeSelect:n,onAutoScroll:d,...o}=s,u=oe("SelectScrollButton",n),a=t.useRef(null),l=je(n),i=t.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return t.useEffect(()=>()=>i(),[i]),te(()=>{l().find(v=>v.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),e.jsx(U.div,{"aria-hidden":!0,...o,ref:r,style:{flexShrink:0,...o.style},onPointerDown:M(o.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(d,50))}),onPointerMove:M(o.onPointerMove,()=>{u.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(d,50))}),onPointerLeave:M(o.onPointerLeave,()=>{i()})})}),Ps="SelectSeparator",bt=t.forwardRef((s,r)=>{const{__scopeSelect:n,...d}=s;return e.jsx(U.div,{"aria-hidden":!0,...d,ref:r})});bt.displayName=Ps;var Pe="SelectArrow",Rs=t.forwardRef((s,r)=>{const{__scopeSelect:n,...d}=s,o=Se(n),u=ne(Pe,n),a=oe(Pe,n);return u.open&&a.position==="popper"?e.jsx(Jt,{...o,...d,ref:r}):null});Rs.displayName=Pe;var Es="SelectBubbleInput",vt=t.forwardRef(({__scopeSelect:s,value:r,...n},d)=>{const o=t.useRef(null),u=J(d,o),a=ts(r);return t.useEffect(()=>{const l=o.current;if(!l)return;const i=window.HTMLSelectElement.prototype,v=Object.getOwnPropertyDescriptor(i,"value").set;if(a!==r&&v){const j=new Event("change",{bubbles:!0});v.call(l,r),l.dispatchEvent(j)}},[a,r]),e.jsx(U.select,{...n,style:{...Kt,...n.style},ref:u,defaultValue:r})});vt.displayName=Es;function wt(s){return s===""||s===void 0}function yt(s){const r=Bt(s),n=t.useRef(""),d=t.useRef(0),o=t.useCallback(a=>{const l=n.current+a;r(l),function i(p){n.current=p,window.clearTimeout(d.current),p!==""&&(d.current=window.setTimeout(()=>i(""),1e3))}(l)},[r]),u=t.useCallback(()=>{n.current="",window.clearTimeout(d.current)},[]);return t.useEffect(()=>()=>window.clearTimeout(d.current),[]),[n,o,u]}function jt(s,r,n){const o=r.length>1&&Array.from(r).every(p=>p===r[0])?r[0]:r,u=n?s.indexOf(n):-1;let a=_s(s,Math.max(u,0));o.length===1&&(a=a.filter(p=>p!==n));const i=a.find(p=>p.textValue.toLowerCase().startsWith(o.toLowerCase()));return i!==n?i:void 0}function _s(s,r){return s.map((n,d)=>s[(r+d)%s.length])}var Ls=Ye,St=Qe,As=Xe,Ms=et,Os=tt,Nt=st,zs=at,Ct=ct,It=mt,Ds=ut,Bs=gt,kt=ht,Tt=ft,Pt=bt;const $s=Ls,Us=As,Rt=t.forwardRef(({className:s,children:r,...n},d)=>e.jsxs(St,{ref:d,className:se("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[r,e.jsx(Ms,{asChild:!0,children:e.jsx(Fe,{className:"h-4 w-4 opacity-50"})})]}));Rt.displayName=St.displayName;const Et=t.forwardRef(({className:s,...r},n)=>e.jsx(kt,{ref:n,className:se("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(ns,{className:"h-4 w-4"})}));Et.displayName=kt.displayName;const _t=t.forwardRef(({className:s,...r},n)=>e.jsx(Tt,{ref:n,className:se("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(Fe,{className:"h-4 w-4"})}));_t.displayName=Tt.displayName;const Lt=t.forwardRef(({className:s,children:r,position:n="popper",...d},o)=>e.jsx(Os,{children:e.jsxs(Nt,{ref:o,className:se("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...d,children:[e.jsx(Et,{}),e.jsx(zs,{className:se("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(_t,{})]})}));Lt.displayName=Nt.displayName;const Vs=t.forwardRef(({className:s,...r},n)=>e.jsx(Ct,{ref:n,className:se("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r}));Vs.displayName=Ct.displayName;const At=t.forwardRef(({className:s,children:r,...n},d)=>e.jsxs(It,{ref:d,className:se("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Bs,{children:e.jsx(ss,{className:"h-4 w-4"})})}),e.jsx(Ds,{children:r})]}));At.displayName=It.displayName;const Hs=t.forwardRef(({className:s,...r},n)=>e.jsx(Pt,{ref:n,className:se("-mx-1 my-1 h-px bg-muted",s),...r}));Hs.displayName=Pt.displayName;const Ws=t.memo(({image:s,isOpen:r,onClose:n})=>{const d=t.useCallback(async()=>{if(s?.url)try{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){window.open(s.url,"_blank");return}const u=await fetch(s.url);if(!u.ok)throw new Error("Failed to fetch image");const a=await u.blob(),l=window.URL.createObjectURL(a),i=document.createElement("a");i.href=l,i.download=s.filename||`character-image-${Date.now()}.png`,i.target="_blank",document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(l)},100)}catch(o){console.error("Failed to download image:",o),window.open(s.url,"_blank")}},[s]);return!r||!s?null:e.jsx("div",{className:"fixed inset-0 z-[999999] flex items-center justify-center bg-black/90 backdrop-blur-sm p-2 sm:p-4",style:{zIndex:999999},onClick:n,children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center image-modal-container",style:{maxWidth:"calc(100vw - 16px)",maxHeight:"calc(100vh - 16px)"},children:[e.jsx("button",{onClick:n,className:"absolute top-2 right-2 z-10 w-8 h-8 sm:w-10 sm:h-10 bg-black/80 hover:bg-black text-white rounded-full flex items-center justify-center transition-colors duration-200 border border-white/20",children:e.jsx(qe,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:d,className:"absolute top-2 right-12 sm:right-16 z-10 w-8 h-8 sm:w-10 sm:h-10 bg-orange-500/80 hover:bg-orange-500 text-white rounded-full flex items-center justify-center transition-colors duration-200 border border-orange-500/40",children:e.jsx(Ee,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("img",{src:s.url,alt:"Generated character image",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl image-modal-image cursor-zoom-in",style:{maxWidth:"calc(100vw - 80px)",maxHeight:"calc(100vh - 80px)",width:"auto",height:"auto",minWidth:"320px",minHeight:"200px"},onClick:o=>o.stopPropagation()})]})})}),Fs=t.memo(()=>e.jsxs("div",{className:"flex-shrink-0 w-48 sm:w-56 lg:w-64 h-64 sm:h-72 lg:h-80 relative overflow-hidden rounded-lg bg-gradient-to-br from-zinc-800 via-zinc-700 to-zinc-800 border border-orange-500/30",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-zinc-600/30 to-transparent animate-pulse"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-zinc-400",children:[e.jsx(rs,{className:"w-8 sm:w-10 lg:w-12 h-8 sm:h-10 lg:h-12 mb-3 sm:mb-4 animate-spin text-orange-500"}),e.jsx("div",{className:"text-sm sm:text-base lg:text-lg font-medium mb-1 sm:mb-2",children:"Generating Image"}),e.jsx("div",{className:"text-xs sm:text-sm text-zinc-500",children:"Please wait..."})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-shimmer"})]})),Gs=t.memo(({image:s,onImageClick:r})=>{const[n,d]=t.useState(!1);if(s.isBuffer)return e.jsx(Fs,{});const o=t.useCallback(a=>{d(!0)},[]),u=t.useCallback(async a=>{a.stopPropagation();try{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){window.open(s.url,"_blank");return}const i=await fetch(s.url);if(!i.ok)throw new Error("Failed to fetch image");const p=await i.blob(),v=window.URL.createObjectURL(p),j=document.createElement("a");j.href=v,j.download=s.filename||`character-image-${Date.now()}.png`,j.target="_blank",document.body.appendChild(j),j.click(),setTimeout(()=>{document.body.removeChild(j),window.URL.revokeObjectURL(v)},100)}catch(l){console.error("Failed to download image:",l),window.open(s.url,"_blank")}},[s]);return e.jsxs("div",{className:"flex-shrink-0 w-48 sm:w-56 lg:w-64 h-64 sm:h-72 lg:h-80 group relative cursor-pointer overflow-hidden rounded-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-xl hover:shadow-orange-500/20 border border-zinc-600/30 hover:border-orange-500/50",onClick:()=>r(s),children:[!n&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-zinc-800 via-zinc-700 to-zinc-800 animate-pulse rounded-lg"}),e.jsx("img",{src:s.url,alt:"Generated character image",className:`w-full h-full object-cover transition-all duration-300 ${n?"opacity-100":"opacity-0"} group-hover:scale-105`,onLoad:o,onError:()=>d(!0),loading:"lazy",decoding:"async"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-300 flex items-center justify-center",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex gap-2 sm:gap-3",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),r(s)},className:"w-10 sm:w-12 h-10 sm:h-12 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110",children:e.jsx(os,{className:"w-5 sm:w-6 h-5 sm:h-6"})}),e.jsx("button",{onClick:u,className:"w-10 sm:w-12 h-10 sm:h-12 bg-orange-500/80 hover:bg-orange-500 backdrop-blur-sm border border-orange-500/40 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110",children:e.jsx(Ee,{className:"w-4 sm:w-5 h-4 sm:h-5"})})]})})]})}),Ks=({images:s,title:r,onImageClick:n})=>{const[d,o]=t.useState(null),[u,a]=t.useState(!1),[l,i]=t.useState(0),p=t.useRef(null),v=t.useCallback(c=>{c.isBuffer||(n?n(c):(o(c),a(!0)))},[n]),j=t.useCallback(()=>{a(!1),o(null)},[]),C=t.useCallback(c=>{if(!p.current)return;const x=p.current;let w=200;window.innerWidth>=640&&(w=240),window.innerWidth>=1024&&(w=280);const b=c==="left"?Math.max(0,l-w):Math.min(x.scrollWidth-x.clientWidth,l+w);x.scrollTo({left:b,behavior:"smooth"}),i(b)},[l]);if(t.useEffect(()=>{const c=p.current;if(!c)return;const x=()=>{i(c.scrollLeft)};return c.addEventListener("scroll",x),()=>c.removeEventListener("scroll",x)},[]),!s||s.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-zinc-400 text-lg",children:"No images generated yet"}),e.jsx("div",{className:"text-zinc-500 text-sm mt-2",children:"Start generating to see your character images here"})]});const P=l>0,I=p.current?l<p.current.scrollWidth-p.current.clientWidth:!1;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[r&&e.jsxs("h3",{className:"text-xl font-semibold text-zinc-200 mb-4 flex items-center gap-2",children:[r,e.jsxs("span",{className:"text-orange-400",children:["(",s.length,")"]})]}),P&&e.jsx("button",{onClick:()=>C("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-black/80 hover:bg-black/90 backdrop-blur-sm border border-white/20 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110 shadow-lg",children:e.jsx(Ge,{className:"w-5 h-5"})}),I&&e.jsx("button",{onClick:()=>C("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-black/80 hover:bg-black/90 backdrop-blur-sm border border-white/20 rounded-full flex items-center justify-center text-white transition-all duration-200 hover:scale-110 shadow-lg",children:e.jsx(Ke,{className:"w-5 h-5"})}),e.jsx("div",{ref:p,className:"flex gap-4 overflow-x-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:s.map((c,x)=>e.jsx(Gs,{image:c,onImageClick:v},c.id||c.url||`image-${x}`))})]}),e.jsx(Ws,{image:d,isOpen:u,onClose:j})]})},qs=t.memo(Ks),ln=()=>{const{user:s}=Qt(),r=ls(),[n]=is(),{toast:d}=Zt(),[o,u]=t.useState(""),[a,l]=t.useState(""),[i,p]=t.useState(""),[v,j]=t.useState(1),[C,P]=t.useState([]),[I,c]=t.useState([]),[x,w]=t.useState(!1),[b,y]=t.useState(0),[K,_]=t.useState(null),[X,L]=t.useState(null),[O,D]=t.useState(!1),[A,B]=t.useState(null);t.useEffect(()=>{const g=new URLSearchParams(window.location.search),f=g.get("characterId"),m=g.get("returnFromGallery");if(f&&(u(f),m==="true")){const h=localStorage.getItem("generate-images-prompt"),k=localStorage.getItem("generate-images-negative-prompt"),S=localStorage.getItem("generate-images-number");h&&l(h),k&&p(k),S&&j(parseInt(S,10)),localStorage.removeItem("generate-images-prompt"),localStorage.removeItem("generate-images-negative-prompt"),localStorage.removeItem("generate-images-number");const N=new URL(window.location.href);N.searchParams.delete("returnFromGallery"),window.history.replaceState({},"",N.toString())}},[n]),t.useEffect(()=>{P([])},[o]),t.useEffect(()=>()=>{K&&(console.log("🧹 Component unmounting, canceling current job"),w(!1),_(null))},[]);const{data:H=[],isLoading:q}=ve({queryKey:["characters"],queryFn:async()=>await(await pe("GET","/api/characters?limit=1000",void 0,{},"medium")).json()}),{data:R}=ve({queryKey:["character",o],queryFn:async()=>await(await pe("GET",`/api/characters/${o}`,void 0,{},"medium")).json(),enabled:!!o}),{data:z}=ve({queryKey:["character-embeddings",o],queryFn:async()=>{const f=await(await pe("GET",`/api/image-generation/embeddings/${o}`,void 0,{},"medium")).json();return{isReady:f.data?.hasEmbeddings||!1,status:f.data?.status||"unknown",totalImages:f.data?.totalImages||0,message:f.data?.message||"Checking..."}},enabled:!!o}),{data:E=[],isLoading:W}=ve({queryKey:["character-images",o],queryFn:async()=>((await(await pe("GET",`/api/image-generation/character/${o}`,void 0,{},"medium")).json()).data?.images||[]).reverse(),enabled:!!o,refetchInterval:3e4}),V={1:6,2:12,4:24,8:35},Y=async()=>{if(!R||!a.trim()||!s)return;const g=Ve.isUserRestricted(s.id.toString());if(g.isRestricted){let h="";switch(g.type){case"banned":h="Your account has been permanently banned for severe content violations. This action cannot be reversed.";break;case"suspended":h=`Your account is suspended until ${g.expiresAt?.toLocaleString()}. Reason: ${g.reason}`;break;case"restricted":h=`Your account is restricted until ${g.expiresAt?.toLocaleString()}. You cannot generate images during this time.`;break;default:h="Your account has been restricted due to content violations."}d({title:"Account Restricted",description:h,variant:"destructive"});return}const f=ds(a);if(!f.isAllowed){Ve.logViolation({userId:s.id.toString(),username:s.username,violationType:"content_filter",severity:f.severity,content:a,blockedWords:f.blockedWords,context:"image_generation",userAgent:navigator.userAgent}),d({title:f.severity===ms.CRITICAL?"Account Banned":"Content Blocked",description:f.message,variant:"destructive"}),L(f.message||null),D(!0),f.shouldBan&&setTimeout(()=>{d({title:"Account Terminated",description:"Your account has been permanently terminated. You will be redirected shortly.",variant:"destructive"})},2e3);return}if(L(null),D(!1),x){console.log("⚠️ Generation already in progress, please wait...");return}w(!0),y(1);const m={id:`buffer-${Date.now()}`,isBuffer:!0};c([m]);try{const h=R.artStyle?.primaryStyle||"anime",k=R.imageGeneration?.model||null;console.log("🎨 Using character art style:",h),console.log("🤖 Using character model:",k),console.log(`🖼️ Generating ${v} images...`);const N=await(await pe("POST","/api/image-generation/generate",{prompt:a,negativePrompt:i,characterId:o,characterName:R.name,characterPersona:R.persona,width:1024,height:1536,steps:25,cfgScale:8,artStyle:h,model:k,nsfw:R.isNsfw||!1,quantity:v,loras:lorasForRequest})).json();if(N.success&&N.data){const T=N.data.jobId;_(T),console.log(`✅ Image generation job started: ${T}`);let $=0;const F=150;let Z=!0;const me=async()=>{if(!Z){console.log("⚠️ Polling cancelled for job:",T);return}console.log(`🔍 Polling job ${T} - attempt ${$+1}/${F}`);try{const Le=await(await pe("GET",`/api/image-generation/jobs/${T}`,void 0,{},"low")).json();if(Le.success){const re=Le.data;if(re.status==="completed"&&re.result){Z=!1;const ue=re.result.imageUrls||[re.result.imageUrl];c([]),P(xe=>[...ue,...xe]),console.log(`✅ Generated ${ue.length} new images successfully. Total generated: ${ue.length+C.length}`),w(!1),y(0),_(null),r.invalidateQueries({queryKey:["character-images",o]});return}else if(re.status==="failed"){Z=!1,console.error("❌ Image generation failed:",re.error),w(!1),y(0),_(null),c([]);return}else{const ue=re.progress||0,xe=Math.max(1,Math.ceil(ue*v/100));y(xe),console.log(`🔄 Generation progress: ${ue}% (${xe}/${v})`)}}}catch(ee){console.error("❌ Error polling job status:",ee)}if($++,$<F&&Z){const ee=Math.min(3e3+$*500,1e4);setTimeout(me,ee)}else Z=!1,$>=F&&console.error("❌ Job polling timeout after 5 minutes"),w(!1),y(0),_(null),c([])};setTimeout(me,3e3)}else console.error("❌ Image generation failed:",N.error),w(!1),y(0),_(null),c([])}catch(h){console.error("❌ Error generating images:",h),w(!1),y(0),_(null),c([])}},ie=V[v],ce=async(g,f)=>{try{const h=await(await fetch(g)).blob(),k=window.URL.createObjectURL(h),S=document.createElement("a");S.href=k,S.download=f,document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(k)}catch(m){console.error("Download failed:",m),window.open(g,"_blank")}},he=(g,f,m)=>{B({image:g,groupImages:f,index:m})},de=()=>{B(null)},Q=g=>{if(!A)return;const{groupImages:f,index:m}=A;let h;g==="prev"?h=m>0?m-1:f.length-1:h=m<f.length-1?m+1:0,B({image:f[h],groupImages:f,index:h})};return e.jsx("div",{className:"pb-20 pt-20 fixed inset-0 bg-gradient-to-br from-zinc-900 via-zinc-800 to-orange-900/20 text-white overflow-hidden",children:e.jsxs("div",{className:"flex flex-col h-full overflow-y-auto lg:overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-4 sm:p-6 pb-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsx(Ue,{href:"/gallery",children:e.jsxs(Me,{variant:"ghost",size:"sm",className:"text-zinc-400 hover:text-white w-fit",children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Back to Gallery"]})}),e.jsxs("div",{className:"flex items-center gap-2 text-orange-400",children:[e.jsx(Be,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-semibold",children:[s?.coins||0," coins"]})]})]}),e.jsxs("div",{className:"mt-4 mb-2 max-w-4xl",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent mb-3 leading-tight",children:"AI Image Generator - Create Custom Character Art"}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-zinc-300 text-sm lg:text-base leading-relaxed",children:"Generate stunning AI images and artwork with your favorite characters. Create custom NSFW and SFW images using advanced AI technology."})}),e.jsxs("div",{className:"bg-red-900/20 border border-red-700 p-3 rounded-lg text-xs lg:flex-shrink-0 lg:max-w-xs",children:[e.jsx("h4",{className:"text-red-400 font-semibold text-xs mb-1",children:"⚠️ User Responsibility"}),e.jsxs("p",{className:"text-gray-300 text-xs leading-relaxed",children:["You are ",e.jsx("strong",{children:"100% responsible"})," for all generated content.",e.jsx(Ue,{href:"/legal/liability-disclaimer",className:"text-blue-400 hover:text-blue-300 underline ml-1 break-words",children:"Read disclaimer"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 lg:gap-6 px-4 sm:px-6 pb-6 mb-0 lg:h-[calc(100vh-120px)] lg:overflow-hidden items-stretch",children:[e.jsx("div",{className:"w-full lg:w-[28rem] flex-shrink-0 flex flex-col lg:h-[65vh]",children:e.jsx(Oe,{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border-orange-500/20 flex-1 flex flex-col lg:h-full",children:e.jsxs(ze,{className:"p-3 sm:p-4 lg:p-2 space-y-3 sm:space-y-4 lg:space-y-1 lg:overflow-y-auto flex-col flex-1 lg:h-full",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 flex-shrink-0",children:[R?e.jsxs("div",{className:"flex items-center gap-3 mb-3 lg:mb-4",children:[e.jsx("img",{src:R.avatar||R.avatarUrl||"/fallback.jpg",alt:R.name,className:"w-10 lg:w-12 h-10 lg:h-12 rounded-full object-cover ring-2 ring-orange-500/30"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"text-base lg:text-lg font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent leading-tight",children:["Generate Images for ",R.name]}),e.jsx("p",{className:"text-zinc-400 text-xs lg:text-sm",children:"Create stunning images"})]})]}):e.jsxs("div",{className:"flex items-center gap-3 mb-3 lg:mb-4",children:[e.jsx("div",{className:"w-10 lg:w-12 h-10 lg:h-12 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center",children:e.jsx(be,{className:"w-5 lg:w-6 h-5 lg:h-6 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-base lg:text-lg font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent",children:"Generate Images"}),e.jsx("p",{className:"text-zinc-400 text-xs lg:text-sm",children:"Create stunning images"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 sm:w-5 h-4 sm:h-5 text-orange-400"}),"Select Character"]}),q?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Xt,{size:"sm",text:"Loading characters..."})}):e.jsxs($s,{value:o,onValueChange:u,children:[e.jsx(Rt,{className:"w-full bg-zinc-800/50 border-zinc-600/30 focus:border-orange-500",children:e.jsx(Us,{placeholder:"Choose a character to generate images with..."})}),e.jsx(Lt,{className:"bg-zinc-800 border-zinc-600/30 max-h-64 overflow-y-auto max-w-[calc(100vw-2rem)] sm:max-w-md",children:H.map(g=>e.jsx(At,{value:g.id,className:"focus:bg-orange-500/20 focus:text-orange-300",children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("img",{src:g.avatar||g.avatarUrl||"/fallback.jpg",alt:g.name,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}),e.jsx("span",{className:"truncate",children:g.name})]})},g.id))})]})]}),o&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg border border-zinc-600/30 bg-zinc-800/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:"Character Embedding Status"})]}),z?e.jsx("div",{className:"flex items-center gap-2",children:z.isReady?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm text-green-400",children:"Ready for image generation"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-yellow-400",children:"Image creation will be available in less than 2 minutes"})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-zinc-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-zinc-400",children:"Checking embedding status..."})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 sm:w-5 h-4 sm:h-5 text-orange-400"}),"Prompt"]}),e.jsx(es,{placeholder:"Describe what you want to see in your image. Tip: Start your prompt with a subject (e.g. A fantasy sorcerer standing in a mystical library...)",value:a,onChange:g=>{const f=g.target.value;if(l(f),f.trim()){const m=cs(f);L(m.isAllowed?null:m.message||null),D(!m.isAllowed)}else L(null),D(!1)},className:`min-h-[100px] sm:min-h-[120px] bg-zinc-800/50 resize-none text-sm lg:text-base transition-colors ${O?"border-red-500 focus:border-red-500":"border-zinc-600 focus:border-orange-500"}`,disabled:!o}),!o&&e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Please select a character first"}),X&&e.jsxs("div",{className:"mt-2 p-3 bg-red-900/20 border border-red-500/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx($e,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Content Warning"})]}),e.jsx("p",{className:"text-sm text-red-300 mt-1",children:X})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Number of Images"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4",children:Object.entries(V).map(([g,f])=>e.jsx("button",{onClick:()=>j(parseInt(g)),disabled:!o,className:`p-2 sm:p-1 rounded-lg border-2 transition-all duration-200 ${v===parseInt(g)?"border-orange-500 bg-orange-500/20":"border-zinc-600 hover:border-orange-400"} ${o?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold",children:g}),e.jsxs("div",{className:"text-xs text-zinc-400 flex items-center justify-center gap-1",children:[e.jsx(Be,{className:"w-2 h-2"}),f]})]})},g))}),e.jsx(Me,{onClick:Y,disabled:!o||!a.trim()||x||O||(s?.coins||0)<ie||z&&!z.isReady,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold py-3 text-base sm:text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Generating ",b," of ",v,"..."]}):O?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5"}),"Content Blocked - Fix Prompt"]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Generate ",v," Image",v>1?"s":""," (",ie," coins)"]})})]})]})})}),e.jsx("div",{className:"flex-1 min-w-0 order-2 lg:order-2 lg:overflow-hidden flex flex-col lg:h-[65vh] min-h-[400px]",children:e.jsx(Oe,{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border-orange-500/20 flex-1 flex flex-col lg:h-full",children:e.jsxs(ze,{className:"p-3 sm:p-4 flex flex-col flex-1 lg:h-full",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4 flex items-center gap-2 flex-shrink-0",children:[e.jsx(be,{className:"w-4 sm:w-5 h-4 sm:h-5 text-orange-400"}),"Workshop"]}),e.jsx("div",{className:"flex-1 flex items-center justify-center overflow-hidden",children:C.length===0&&I.length===0&&E.length===0?e.jsxs("div",{className:"text-center px-4",children:[e.jsx(be,{className:"w-12 sm:w-16 lg:w-24 h-12 sm:h-16 lg:h-24 mx-auto mb-3 sm:mb-4 lg:mb-6 opacity-30 text-zinc-400"}),e.jsx("p",{className:"text-lg sm:text-xl lg:text-3xl font-medium mb-2 lg:mb-4 text-zinc-400",children:"Your Creative Workshop"}),e.jsx("p",{className:"text-sm sm:text-base lg:text-xl mb-2 lg:mb-3 text-zinc-500",children:"Generated images will appear here"}),!o&&e.jsx("p",{className:"text-xs sm:text-sm lg:text-lg text-zinc-600 mt-2 lg:mt-4",children:"Select a character and start creating amazing images"})]}):e.jsx("div",{className:"w-full",children:e.jsx(qs,{images:[...I.map(g=>({url:"",id:g.id,isBuffer:!0})),...C.map((g,f)=>({url:g,id:`generated-${f}`,filename:`generated-image-${Date.now()}-${f+1}.webp`})),...C.length===0&&I.length===0?E.slice(0,8).map((g,f)=>({url:g.url,id:`existing-${f}`,filename:g.filename||`character-image-${f+1}.webp`})):[]],title:I.length>0?"Generating Images...":C.length>0?`Generated Images (${C.length})`:E.length>0?`Character Images (${E.length})`:void 0,onImageClick:g=>{const f=[...C.map((h,k)=>({url:h,id:`generated-${k}`,filename:`generated-image-${Date.now()}-${k+1}.webp`})),...C.length===0&&I.length===0?E.slice(0,8).map((h,k)=>({url:h.url,id:`existing-${k}`,filename:h.filename||`character-image-${k+1}.webp`})):[]],m=f.findIndex(h=>h.id===g.id);m!==-1&&he(g,f,m)}})})})]})})})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 sm:p-8",onClick:de,children:e.jsxs("div",{className:"relative bg-zinc-800/90 backdrop-blur-md rounded-lg w-full h-auto max-w-4xl max-h-[90vh] overflow-hidden border border-orange-500/30 flex flex-col",style:{maxWidth:"calc(100vw - 32px)",maxHeight:"calc(100vh - 160px)"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-4 border-b border-orange-500/20 flex-shrink-0",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-sm sm:text-base truncate",children:"Generated Image"}),e.jsxs("p",{className:"text-zinc-300 text-xs sm:text-sm",children:["Image ",A.index+1," of ",A.groupImages.length]})]}),e.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>ce(A.image.url,A.image.filename||`generated-image-${A.index+1}.png`),className:"bg-orange-600 hover:bg-orange-700 text-white p-1.5 sm:p-2 rounded-lg transition-colors",children:e.jsx(Ee,{size:16,className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:de,className:"bg-zinc-700 hover:bg-zinc-600 text-white p-1.5 sm:p-2 rounded-lg transition-colors",children:e.jsx(qe,{size:16,className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsxs("div",{className:"relative flex-1 flex items-center justify-center p-4",children:[e.jsx("img",{src:A.image.url,alt:`Generated image ${A.index+1}`,className:"max-w-full max-h-full object-contain mx-auto block",style:{maxWidth:"calc(100vw - 96px)",maxHeight:"calc(100vh - 240px)"}}),A.groupImages.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Q("prev"),className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 bg-black/60 hover:bg-black/80 text-white p-1.5 sm:p-2 rounded-full transition-colors",children:e.jsx(Ge,{size:20,className:"w-4 h-4 sm:w-6 sm:h-6"})}),e.jsx("button",{onClick:()=>Q("next"),className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 bg-black/60 hover:bg-black/80 text-white p-1.5 sm:p-2 rounded-full transition-colors",children:e.jsx(Ke,{size:20,className:"w-4 h-4 sm:w-6 sm:h-6"})})]})]})]})})]})})};export{ln as default};
