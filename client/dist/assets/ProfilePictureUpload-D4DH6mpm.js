const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/csrfProtection-Bm2x5mqN.js","assets/index-oGocYDT2.js","assets/ui-vendor-yJ52fMSG.js","assets/react-vendor-CgzYKCvO.js","assets/routing-DoJeAdmJ.js","assets/query-vendor-8KRGqY0G.js","assets/utils--BulIq_u.js","assets/icons-CPY5GJO9.js"])))=>i.map(i=>d[i]);
import{j as d}from"./ui-vendor-yJ52fMSG.js";import{r as v}from"./react-vendor-CgzYKCvO.js";import{_ as b,u as j,d as x}from"./index-oGocYDT2.js";import{c as P}from"./utils--BulIq_u.js";import{ag as $,ah as _}from"./icons-CPY5GJO9.js";const f=class f{static getPublicUrl(e){return`https://${this.publicDomain}/${e}`}static getCharacterFolderPaths(e,t){const a=t.toLowerCase().replace(/[^a-z0-9]/g,"-"),r=t==="general",i=r?`${e}/images`:`${e}/characters/${a}`;return{baseFolder:i,avatarFolder:`${i}/avatar`,imagesFolder:r?i:`${i}/images`,variationsFolder:`${i}/variations`,embeddingsFolder:`${i}/embeddings`,generationsFolder:`${i}/generations`}}static getPremadeCharacterFolderPaths(e,t){const a=t.toLowerCase().replace(/[^a-z0-9]/g,"-"),r=`${e}/premade_characters/${a}`;return{baseFolder:r,avatarFolder:`${r}/avatar`,imagesFolder:`${r}/images`,variationsFolder:`${r}/variations`,embeddingsFolder:`${r}/embeddings`,generationsFolder:`${r}/generations`}}static parseBunnyUrl(e){const a=new URL(e).pathname.substring(1).split("/");if(a.length<2)return null;const r=a[0],i=a[1];let s="",o="",n="";return i==="characters"||i==="premade_characters"?a.length>=4&&(s=a[2],o=a[3],n=a[4]||""):i==="avatar"&&(o="avatar",n=a[2]||""),{username:r,mainFolder:i,characterName:s,folder:o,fileName:n,isAvatar:o==="avatar",isCharacter:i==="characters",isPremadeCharacter:i==="premade_characters"}}static getImageDimensions(e){switch(e){case"avatar":return{width:400,height:400};case"character":return{width:512,height:512};default:return{width:400,height:400}}}static validateImageFile(e,t){const a={avatar:5242880,character:10485760};if(!e.type.startsWith("image/"))return{isValid:!1,error:"File must be an image"};if(e.size>a[t])return{isValid:!1,error:"The image is too big, choose something smaller"};const r=["image/jpeg","image/png","image/gif","image/webp"];return e.type.includes("image/")?r.includes(e.type)?{isValid:!0}:{isValid:!1,error:"Image must be JPEG, PNG, GIF, or WebP"}:{isValid:!1,error:"Invalid file type"}}static generateUniqueFilename(e,t){const a=Date.now(),r=Math.random().toString(36).substring(2,8);return`${e}_${a}_${r}${t}`}static getFileExtension(e){const t=e.split(".");return t.length>1?`.${t.pop()}`:""}static getMimeType(e){const t=e.toLowerCase().split(".").pop();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",mp4:"video/mp4",webm:"video/webm",mov:"video/quicktime",txt:"text/plain",json:"application/json",pdf:"application/pdf"}[t||""]||"application/octet-stream"}};f.publicDomain="medusa-vrfriendly.vercel.app";let h=f;const p=class p{static validateImage(e){return h.validateImageFile(e,"avatar")}static async uploadImage(e){try{return await this.uploadToBackend(e)}catch(t){throw console.error("Backend upload failed:",t),new Error("Failed to upload image. Please try again.")}}static async uploadToCloudinary(e){const t=new FormData;t.append("file",e),t.append("upload_preset",this.CLOUDINARY_UPLOAD_PRESET);const a=await fetch(`https://api.cloudinary.com/v1_1/${this.CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:t});if(!a.ok)throw new Error(`Cloudinary upload failed: ${a.statusText}`);return(await a.json()).secure_url}static async fileToDataUrl(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=()=>a(new Error("Failed to read file")),r.readAsDataURL(e)})}static async resizeImage(e,t=400,a=400){return new Promise((r,i)=>{const s=document.createElement("canvas"),o=s.getContext("2d"),n=new Image;n.onload=()=>{let{width:l,height:c}=n;l>c&&l>t?(c=c*t/l,l=t):c>a&&(l=l*a/c,c=a),s.width=l,s.height=c,o?.drawImage(n,0,0,l,c),r(s.toDataURL("image/jpeg",.8))},n.onerror=()=>i(new Error("Failed to load image")),n.src=URL.createObjectURL(e)})}static async uploadToBackend(e){const t=new FormData;t.append("avatar",e);const{secureApiRequest:a}=await b(async()=>{const{secureApiRequest:s}=await import("./csrfProtection-Bm2x5mqN.js");return{secureApiRequest:s}},__vite__mapDeps([0,1,2,3,4,5,6,7])),r=await a("POST","/api/upload/avatar",t,{},{requireCsrf:!0,priority:"high"});if(!r.ok)throw new Error(`Upload failed: ${r.statusText}`);return(await r.json()).url}static async uploadCharacterImage(e,t){const a=new FormData;a.append("characterImage",e),t&&a.append("characterId",t);const{secureApiRequest:r}=await b(async()=>{const{secureApiRequest:o}=await import("./csrfProtection-Bm2x5mqN.js");return{secureApiRequest:o}},__vite__mapDeps([0,1,2,3,4,5,6,7])),i=await r("POST","/api/upload/character",a,{},{requireCsrf:!0,priority:"high"});if(!i.ok)throw new Error(`Character image upload failed: ${i.statusText}`);return(await i.json()).url}};p.CLOUDINARY_CLOUD_NAME="your-cloudinary-cloud-name",p.CLOUDINARY_UPLOAD_PRESET="your-upload-preset";let u=p;function R({currentAvatarUrl:y,onAvatarUpdate:e,className:t}){const{user:a}=j(),{toast:r}=x(),i=v.useRef(null),[s,o]=v.useState(!1),n=async F=>{const m=F.target.files?.[0];if(!m)return;const w=u.validateImage(m);if(!w.isValid){r({title:"Invalid file",description:w.error,variant:"destructive"});return}try{o(!0);const g=await u.uploadImage(m);e?.(g),r({title:"Profile picture updated",description:"Your profile picture has been successfully updated"})}catch(g){console.error("Error uploading image:",g),r({title:"Upload failed",description:"Failed to upload the image. Please try again.",variant:"destructive"})}finally{o(!1)}},l=()=>{i.current?.click()},c=y||a?.avatarUrl||a?.avatar||`https://ui-avatars.com/api/?background=ea580c&color=ffffff&bold=true&name=${encodeURIComponent(a?.username||"User")}`;return d.jsxs("div",{className:P("relative group",t),children:[d.jsxs("div",{className:"relative",children:[d.jsx("img",{src:c,alt:"Profile picture",className:"w-24 h-24 rounded-full border-2 border-orange-500/30 shadow-lg object-cover"}),!s&&d.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center cursor-pointer",onClick:l,children:d.jsx($,{className:"w-6 h-6 text-white"})}),!s&&d.jsx("button",{onClick:l,className:"absolute -bottom-1 -right-1 w-8 h-8 bg-orange-500 hover:bg-orange-600 rounded-full border-2 border-zinc-900 flex items-center justify-center transition-colors shadow-lg",title:"Upload new profile picture",children:d.jsx(_,{className:"w-4 h-4 text-white"})}),s&&d.jsx("div",{className:"absolute inset-0 bg-black/70 rounded-full flex items-center justify-center",children:d.jsx("div",{className:"w-6 h-6 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"})})]}),d.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:n,className:"hidden"})]})}export{R as P};
