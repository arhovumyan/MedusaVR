import{j as e}from"./ui-vendor-wCvZxCWV.js";import{r as m}from"./react-vendor-CgzYKCvO.js";import{u as I,d as U,e as o,B as n,L as R,c as Y,a as i}from"./index-BosckDuJ.js";import{L as u}from"./routing-DoJeAdmJ.js";import{T as q,C as b,z as D,A as H,D as J,J as K,L as p,m as O,K as A,N as W,O as E,q as X}from"./icons-BCb4Ufys.js";import"./query-vendor-BCFDQDjj.js";import"./utils--BulIq_u.js";function re(){const[t,j]=m.useState(null),[N,f]=m.useState([]),[L,v]=m.useState(!0),[l,c]=m.useState(null),{user:r,isAuthenticated:h}=I(),{toast:d}=U();m.useEffect(()=>{h&&w()},[h]);const w=async()=>{try{v(!0);try{const s=await o.getSubscriptionStatus();j(s.subscription)}catch(s){console.warn("Failed to load subscription status:",s),j(null)}try{const s=await o.getInvoices();f(s.invoices||[])}catch(s){console.warn("Invoices endpoint not available:",s),f([])}}catch(s){console.error("Failed to load subscription data:",s),d({title:"Error",description:"Failed to load subscription data. Please try again.",variant:"destructive"})}finally{v(!1)}},F=async()=>{if(t){c("cancel");try{await o.cancelSubscription(t.id),await o.updateUserTier("free"),d({title:"Subscription Cancelled",description:"Your subscription has been cancelled and your tier has been changed to Free. You'll still have access until the end of your billing period."}),await w()}catch(s){console.error("Failed to cancel subscription:",s),d({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}finally{c(null)}}},y=async()=>{c("billing");try{const s=await o.createPortalSession();s.url&&(window.location.href=s.url)}catch(s){console.error("Failed to create portal session:",s),d({title:"Error",description:"Failed to open billing portal. Please try again.",variant:"destructive"})}finally{c(null)}},$=async()=>{c("payment");try{const s=await o.updatePaymentMethod();s.url?window.location.href=s.url:await y()}catch(s){console.error("Failed to update payment method:",s),d({title:"Error",description:"Failed to update payment method. Please try again.",variant:"destructive"})}finally{c(null)}},k=s=>{switch(s){case"active":return e.jsx(i,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"});case"canceled":return e.jsx(i,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"Cancelled"});case"past_due":return e.jsx(i,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Past Due"});case"unpaid":return e.jsx(i,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"Unpaid"});default:return e.jsx(i,{className:"bg-zinc-500/20 text-zinc-400 border-zinc-500/30",children:s})}},z=s=>{const x={free:"bg-gray-500/20 text-gray-400 border-gray-500/30",artist:"bg-blue-500/20 text-blue-400 border-blue-500/30",virtuoso:"bg-purple-500/20 text-purple-400 border-purple-500/30",icon:"bg-orange-500/20 text-orange-400 border-orange-500/30"};return e.jsxs(i,{className:x[s]||x.free,children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},a=s=>new Date(s).toLocaleDateString(),B=s=>{if(!s||s.status==="canceled")return"No upcoming payment";const x=new Date(s.currentPeriodEnd),P=new Date,C=s.planId||"",M=C.toLowerCase().includes("yearly")||C.toLowerCase().includes("annual");if(x>P){const T=x.getTime()-P.getTime(),g=Math.ceil(T/(1e3*3600*24));return g===1?`Tomorrow (${a(s.currentPeriodEnd)})`:g<=7?`In ${g} days (${a(s.currentPeriodEnd)})`:`${a(s.currentPeriodEnd)} (${M?"Yearly":"Monthly"} billing)`}return a(s.currentPeriodEnd)},S=s=>`$${(s/100).toFixed(2)}`;return h?L?e.jsx("div",{className:"text-white px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(R,{size:"lg",text:"Loading subscription..."})})})}):e.jsx("div",{className:"text-white px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent",children:"Subscription Management"}),!t&&e.jsx(u,{href:"/subscribe",children:e.jsxs(n,{className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Subscribe Now"]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border border-orange-500/20 rounded-2xl p-6 shadow-2xl shadow-orange-500/10",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("h2",{className:"text-xl font-semibold text-zinc-200 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-orange-400"}),"Current Subscription"]})}),t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-zinc-200 mb-1",children:t.planId||"Unknown Plan"}),e.jsxs("div",{className:"flex items-center gap-2",children:[z(r?.tier||"free"),k(t.status)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-400",children:r?.subscription?.plan?r.subscription.billingPeriod==="yearly"?`$${r.subscription.plan==="artist"?"144":r.subscription.plan==="virtuoso"?"239":"479"}`:`$${r.subscription.plan==="artist"?"12":r.subscription.plan==="virtuoso"?"20":"40"}`:S(t.amount||0)}),e.jsx("p",{className:"text-sm text-zinc-400",children:r?.subscription?.billingPeriod==="yearly"?"per year":"per month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-zinc-400"}),e.jsx("span",{className:"text-sm text-zinc-400",children:"Current Period"})]}),e.jsx("p",{className:"text-zinc-300",children:r?.subscription?.startDate&&r?.subscription?.endDate?e.jsxs(e.Fragment,{children:[a(r.subscription.startDate)," - ",a(r.subscription.endDate),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-orange-400 font-medium",children:r.subscription.billingPeriod==="yearly"?"Annual Subscription":"Monthly Subscription"})]}):t?`${a(t.currentPeriodStart)} - ${a(t.currentPeriodEnd)}`:"No active subscription"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-zinc-400",children:"Subscription Ends"})]}),e.jsx("p",{className:"text-zinc-300",children:r?.subscription?.endDate?e.jsxs(e.Fragment,{children:[a(r.subscription.endDate),r.subscription.status==="active"&&r.subscription.autoRenew&&e.jsxs("span",{className:"block text-xs text-green-400 mt-1",children:["Auto-renew enabled (",r.subscription.billingPeriod||"monthly",")"]}),r.subscription.status==="canceled"&&e.jsx("span",{className:"block text-xs text-orange-400 mt-1",children:"Will not renew"})]}):t?B(t):"N/A"})]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-orange-500/30 to-transparent my-6"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(u,{href:"/subscribe",children:e.jsxs(n,{className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Change Plan"]})}),e.jsxs(n,{onClick:$,disabled:l==="payment",className:"w-full bg-zinc-800/50 border border-blue-500/30 text-blue-400 hover:bg-blue-500/10 hover:border-blue-500/50",variant:"outline",children:[l==="payment"?e.jsx(p,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(D,{className:"w-4 h-4 mr-2"}),"Update Payment"]}),e.jsxs(n,{onClick:y,disabled:l==="billing",className:"w-full bg-zinc-800/50 border border-green-500/30 text-green-400 hover:bg-green-500/10 hover:border-green-500/50",variant:"outline",children:[l==="billing"?e.jsx(p,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(O,{className:"w-4 h-4 mr-2"}),"Manage Billing"]}),t.status==="active"&&e.jsxs(n,{onClick:F,disabled:l==="cancel",className:"w-full bg-red-500/20 border border-red-500/30 text-red-400 hover:bg-red-500/30 hover:border-red-500/50",variant:"outline",children:[l==="cancel"?e.jsx(p,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(A,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),e.jsxs("div",{className:"bg-zinc-900/50 border border-zinc-700 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-zinc-300 mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Subscription Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-400",children:"Plan Type"}),e.jsxs("p",{className:"text-zinc-200 font-medium",children:[(t.planId||"").toLowerCase().includes("yearly")?"Annual":"Monthly"," Billing"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-400",children:"Member Since"}),e.jsx("p",{className:"text-zinc-200 font-medium",children:a(t.createdAt||t.currentPeriodStart)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-zinc-400",children:"Auto-Renewal"}),e.jsx("p",{className:"text-zinc-200 font-medium",children:t.status==="canceled"?"Disabled":"Enabled"})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-zinc-200",children:"No Active Subscription"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-zinc-400 mb-2",children:["Current Tier: ",z(r?.tier||"free")]}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Subscribe to a plan to access premium features and content."})]}),e.jsx(u,{href:"/subscribe",children:e.jsx(n,{className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white",children:"Browse Plans"})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border border-orange-500/20 rounded-2xl p-6 shadow-2xl shadow-orange-500/10",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("h2",{className:"text-xl font-semibold text-zinc-200 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-orange-400"}),"Billing History"]})}),N.length>0?e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-orange-500/20 rounded-lg bg-zinc-800/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:Y("w-3 h-3 rounded-full",s.status==="paid"?"bg-green-500":"bg-red-500")}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-zinc-200",children:S(s.amount)}),e.jsx("p",{className:"text-sm text-zinc-400",children:a(s.createdAt)})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(i,{className:s.status==="paid"?"bg-green-500/20 text-green-400 border-green-500/30":"bg-red-500/20 text-red-400 border-red-500/30",children:[s.status==="paid"?e.jsx(X,{className:"w-3 h-3 mr-1"}):e.jsx(A,{className:"w-3 h-3 mr-1"}),s.status]})})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-400",children:"No billing history available"})]})]})]})}):e.jsx("div",{className:"text-white px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"bg-gradient-to-br from-zinc-800/50 to-zinc-900/50 backdrop-blur-lg border border-orange-500/20 rounded-2xl p-8 text-center shadow-2xl shadow-orange-500/10",children:[e.jsx(q,{className:"w-12 h-12 text-orange-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-zinc-200",children:"Authentication Required"}),e.jsx("p",{className:"text-zinc-400 mb-4",children:"Please log in to manage your subscription."}),e.jsx(u,{href:"/login",children:e.jsx(n,{className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white",children:"Log In"})})]})})})}export{re as default};
