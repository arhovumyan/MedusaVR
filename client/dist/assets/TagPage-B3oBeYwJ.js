import{j as e}from"./ui-vendor-yJ52fMSG.js";import{r as g}from"./react-vendor-CgzYKCvO.js";import{c as C,L as d}from"./routing-DoJeAdmJ.js";import{h as T,t as L,l as F,L as P,B as p,b as B}from"./index-BjPJS_Ij.js";import{b as A}from"./query-vendor-8KRGqY0G.js";import{C as U}from"./cards-BKefm5w4.js";import{R as v,r as E,al as M}from"./icons-B1tK8ZjU.js";import"./utils--BulIq_u.js";const D=()=>{const[w,f]=C("/tags/:tagName"),r=f?.tagName?decodeURIComponent(f.tagName):"",{tagCategories:h=[],tagMap:u}=T(),{isFavorite:R,toggleFavorite:N}=L(),{showNSFW:$}=F();g.useCallback((a,s)=>{a.preventDefault(),a.stopPropagation();const t={id:parseInt(s.id)||0,avatar:s.avatarUrl||s.avatar||s.imageUrl||s.profile_image||"",name:s.name,description:s.description||s.persona||"No description available",rating:s.rating?.toString()||"PG",nsfw:s.isNsfw||s.nsfw||!1,chatCount:s.chatCount||0};N(t)},[N]);const l=g.useMemo(()=>h.flatMap(s=>s.tags).find(s=>s.name.toLowerCase()===r.toLowerCase()||s.displayName.toLowerCase()===r.toLowerCase()),[h,r]),{data:m=[],isLoading:y,error:b}=A({queryKey:["characters"],queryFn:async()=>await(await B("GET","/api/characters")).json()}),c=g.useMemo(()=>{if(!r||!m.length)return[];console.log(`[TagPage] Filtering for tag: "${r}"`),console.log(`[TagPage] Total characters: ${m.length}`);const a=m.filter(s=>{if(!s||!s.id)return console.warn("Filtering out character with missing data:",s),!1;let t=!1;const o=r.toLowerCase();return s.selectedTags&&typeof s.selectedTags=="object"&&(t=Object.values(s.selectedTags).some(n=>n?.some(i=>{const x=u?.[i];return x?x.name?.toLowerCase()===o||x.displayName?.toLowerCase()===o:i?.toLowerCase()===o}))),!t&&s.tagNames&&Array.isArray(s.tagNames)&&(t=s.tagNames.some(n=>n?.toLowerCase()===o)),!t&&s.tags&&Array.isArray(s.tags)&&(t=s.tags.some(n=>n?.toLowerCase()===o)),!t&&s.selectedTags&&(t=Object.values(s.selectedTags).flat().filter(Boolean).some(i=>typeof i=="string"?i.toLowerCase()===o:!1)),t&&console.log(`[TagPage] Character "${s.name}" matches tag "${r}"`),t});return console.log(`[TagPage] Filtered characters: ${a.length}`),a},[m,r,u]),j=g.useMemo(()=>c.map(a=>({id:parseInt(a.id)||0,avatar:a.avatarUrl||a.avatar||a.imageUrl||a.profile_image||"",name:a.name,description:a.description||a.persona||"No description available",rating:a.rating?.toString()||"PG",nsfw:a.isNsfw||a.nsfw||!1,chatCount:a.chatCount||0,tagNames:a.tagNames})),[c]);return w?y?e.jsx("div",{className:"text-white min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 lg:px-0 py-8",children:e.jsx("div",{className:"flex items-center justify-center py-32",children:e.jsx(P,{size:"xl",text:"Loading characters..."})})})}):b?e.jsx("div",{className:"text-white min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 lg:px-0 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"Error Loading Characters"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"There was an error loading characters for this tag."}),e.jsx(d,{href:"/gallery",children:e.jsxs(p,{variant:"outline",className:"border-orange-500/30 text-orange-300 hover:bg-orange-500/10",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Back to Gallery"]})})]})})}):e.jsx("div",{className:"text-white min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 lg:px-0 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx(d,{href:"/gallery",children:e.jsxs(p,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white hover:bg-gray-800",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Back"]})})}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l?.emoji&&e.jsx("span",{className:"text-3xl",children:l.emoji}),e.jsx("div",{children:e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-orange-400 to-orange-600 bg-clip-text text-transparent",children:l?.displayName||r})})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsxs("span",{children:[c.length," characters"]})]}),l?.category&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:l.category.replace("_"," ")})]})]})]}),j.length>0?e.jsx(U,{externalCharacters:j,externalLoading:!1,externalError:null}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"mb-4 text-6xl opacity-20",children:l?.emoji||"üîç"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-300 mb-2",children:"No characters found"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:['There are currently no characters with the "',l?.displayName||r,'" tag.']}),e.jsx(d,{href:"/gallery",children:e.jsx(p,{variant:"outline",className:"border-orange-500/30 text-orange-300 hover:bg-orange-500/10 hover:border-orange-500/50",children:"Browse All Characters"})})]})]})}):null};export{D as default};
