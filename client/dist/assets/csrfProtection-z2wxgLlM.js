const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DDdEVrIf.js","assets/ui-vendor-yJ52fMSG.js","assets/react-vendor-CgzYKCvO.js","assets/routing-DoJeAdmJ.js","assets/query-vendor-8KRGqY0G.js","assets/utils--BulIq_u.js","assets/icons-CPY5GJO9.js"])))=>i.map(i=>d[i]);
import{_ as T}from"./index-DDdEVrIf.js";import"./ui-vendor-yJ52fMSG.js";import"./react-vendor-CgzYKCvO.js";import"./routing-DoJeAdmJ.js";import"./query-vendor-8KRGqY0G.js";import"./utils--BulIq_u.js";import"./icons-CPY5GJO9.js";let i=null,l=0;async function y(){try{const t=await fetch("/api/csrf-token",{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Failed to fetch CSRF token: ${t.status}`);const e=await t.json();if(!e.csrfToken)throw new Error("No CSRF token in response");return i=e.csrfToken,l=Date.now()+50*60*1e3,console.log("üõ°Ô∏è CSRF token obtained successfully"),e.csrfToken}catch(t){throw console.error("‚ùå Failed to fetch CSRF token:",t),t}}async function s(){return i&&Date.now()<l?i:await y()}async function p(t={}){try{const e=await s();return{...t,"X-CSRF-Token":e}}catch(e){return console.warn("‚ö†Ô∏è Could not add CSRF token to headers:",e),t}}async function C(t){try{const e=await s();return t.append("_csrf",e),t}catch(e){return console.warn("‚ö†Ô∏è Could not add CSRF token to form data:",e),t}}async function k(t){try{const e=await s();return{...t,_csrf:e}}catch(e){return console.warn("‚ö†Ô∏è Could not add CSRF token to body:",e),t}}function h(){i=null,l=0,console.log("üóëÔ∏è CSRF token cache cleared")}async function j(t,e,r,f={},F={}){const{requireCsrf:R=!0,priority:u="medium"}=F,d=R&&["POST","PUT","PATCH","DELETE"].includes(t.toUpperCase());let a=f,o=r;if(d)try{a=await p(f),r instanceof FormData?o=await C(r):r&&typeof r=="object"&&(o=await k(r))}catch(n){console.warn("‚ö†Ô∏è CSRF token handling failed, proceeding without token:",n)}const{apiRequest:w}=await T(async()=>{const{apiRequest:n}=await import("./index-DDdEVrIf.js").then(c=>c.N);return{apiRequest:n}},__vite__mapDeps([0,1,2,3,4,5,6]));try{return await w(t,e,o,a,u)}catch(n){if(n.status===403&&n.message?.includes("CSRF")&&(console.warn("üõ°Ô∏è CSRF token invalid, clearing cache and retrying..."),h(),d))try{return a=await p(f),r instanceof FormData?o=await C(r):r&&typeof r=="object"&&(o=await k(r)),await w(t,e,o,a,u)}catch(c){throw console.error("‚ùå CSRF retry failed:",c),c}throw n}}typeof window<"u"&&(s().catch(t=>{console.warn("‚ö†Ô∏è Could not pre-fetch CSRF token:",t)}),window.addEventListener("beforeunload",h));export{k as addCsrfToBody,C as addCsrfToFormData,p as addCsrfToHeaders,h as clearCsrfToken,y as fetchCsrfToken,s as getCsrfToken,j as secureApiRequest};
