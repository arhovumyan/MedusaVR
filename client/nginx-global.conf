# Global nginx directives - this file should be included in the main nginx.conf

# Rate limiting zone definitions
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=auth:10m rate=3r/s;

# Generate secure CSP nonce
map $request_id $csp_nonce {
    ~^(.{8}) $1;
    default "invalid";
}

# Add entropy for better nonce generation
map $time_iso8601$remote_addr$request_id $secure_nonce {
    ~^(.{16}) $1;
    default "fallback";
}
